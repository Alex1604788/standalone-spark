# üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ –ú–ò–ì–†–ê–¶–ò–ô –û–ß–ò–°–¢–ö–ò –õ–û–ì–û–í

**–î–∞—Ç–∞:** 2026-01-25
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

---

## üéØ –ß–¢–û –ë–£–î–ï–¢ –°–î–ï–õ–ê–ù–û

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å 7 –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

1. **cleanup_ai_reply_history** - –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ AI –æ—Ç–≤–µ—Ç–æ–≤ (30 –¥–Ω–µ–π)
2. **cleanup_logs_ai** - –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫ AI (7 –¥–Ω–µ–π)
3. **cleanup_import_logs** - –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –∏–º–ø–æ—Ä—Ç–∞ (7 –¥–Ω–µ–π)
4. **cleanup_ozon_sync_history** - –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π OZON (30 –¥–Ω–µ–π)
5. **cleanup_cron_job_run_details** - –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ CRON –∑–∞–¥–∞—á (7 –¥–Ω–µ–π)
6. **cleanup_fallback_action_logs** - –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ fallback –¥–µ–π—Å—Ç–≤–∏–π (7 –¥–Ω–µ–π)
7. **cleanup_consent_logs** - —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ consent_logs (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å)

---

## üìù –®–ê–ì 1: –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ú–ò–ì–†–ê–¶–ò–ô

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ Supabase Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç

2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor:**
   - –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ "SQL Editor"
   - –ù–∞–∂–º–∏—Ç–µ "New query"

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**

   –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `COMBINED_CLEANUP_MIGRATIONS.sql` –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ SQL Editor.

   **–ò–õ–ò** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏:
   - `supabase/migrations/20260125120000_cleanup_ai_reply_history.sql`
   - `supabase/migrations/20260125120100_cleanup_logs_ai.sql`
   - `supabase/migrations/20260125120200_cleanup_import_logs.sql`
   - `supabase/migrations/20260125120300_cleanup_ozon_sync_history.sql`
   - `supabase/migrations/20260125120400_cleanup_cron_job_run_details.sql`
   - `supabase/migrations/20260125120500_cleanup_fallback_action_logs.sql`
   - `supabase/migrations/20260125120600_cleanup_consent_logs.sql`

4. **–ù–∞–∂–º–∏—Ç–µ "Run"** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –∏ CRON –∑–∞–¥–∞—á
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ (ERROR)

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ Supabase CLI (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
supabase db push
```

### –í–∞—Ä–∏–∞–Ω—Ç –í: –ß–µ—Ä–µ–∑ psql (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î)

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
psql -h your-db-host -U postgres -d postgres -f COMBINED_CLEANUP_MIGRATIONS.sql

# –ò–õ–ò –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–∞–∂–¥—É—é –º–∏–≥—Ä–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ
psql -h your-db-host -U postgres -d postgres -f supabase/migrations/20260125120000_cleanup_ai_reply_history.sql
psql -h your-db-host -U postgres -d postgres -f supabase/migrations/20260125120100_cleanup_logs_ai.sql
# ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
```

---

## ‚úÖ –®–ê–ì 2: –ü–†–û–í–ï–†–ö–ê –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å—ë —Å–æ–∑–¥–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

### 2.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ SQL Editor

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `CHECK_CLEANUP_SETUP.sql` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –≤ SQL Editor.

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 7 —Ñ—É–Ω–∫—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã 7 CRON –∑–∞–¥–∞—á
- ‚úÖ –ü–æ–∫–∞–∑–∞–Ω —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü —Å –ª–æ–≥–∞–º–∏
- ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–≤—Å–µ–≥–æ –∏ —Å—Ç–∞—Ä—ã—Ö)

### 2.2. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
SELECT
  routine_name,
  routine_type
FROM information_schema.routines
WHERE routine_schema = 'public'
  AND routine_name LIKE 'cleanup_%'
ORDER BY routine_name;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 7 —Ñ—É–Ω–∫—Ü–∏–π

### 2.3. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ CRON –∑–∞–¥–∞—á

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ CRON –∑–∞–¥–∞—á–∏
SELECT
  jobname,
  schedule,
  active,
  jobid
FROM cron.job
WHERE jobname LIKE 'cleanup-%'
ORDER BY jobname;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 7 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á

---

## üß™ –®–ê–ì 3: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü!

### 3.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –ø–æ–¥–ª–µ–∂–∏—Ç —É–¥–∞–ª–µ–Ω–∏—é
SELECT
  'ai_reply_history' as table_name,
  COUNT(*) as old_records
FROM public.ai_reply_history
WHERE created_at < NOW() - INTERVAL '30 days'

UNION ALL

SELECT
  'logs_ai',
  COUNT(*)
FROM public.logs_ai
WHERE created_at < NOW() - INTERVAL '7 days'

UNION ALL

SELECT
  'import_logs',
  COUNT(*)
FROM public.import_logs
WHERE created_at < NOW() - INTERVAL '7 days'

-- ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
```

### 3.2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `TEST_CLEANUP_FUNCTIONS.sql` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –≤ SQL Editor.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –î–û –æ—á–∏—Å—Ç–∫–∏
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ 7 —Ñ—É–Ω–∫—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –ü–û–°–õ–ï –æ—á–∏—Å—Ç–∫–∏
4. –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: —Å–∫–æ–ª—å–∫–æ —É–¥–∞–ª–µ–Ω–æ, –∑–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è

### 3.3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é –≤—Ä—É—á–Ω—É—é

```sql
-- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, logs_ai)
SELECT * FROM public.cleanup_logs_ai();
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∫–∞–∂–µ—Ç —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π —É–¥–∞–ª–µ–Ω–æ, –∑–∞ —Å–∫–æ–ª—å–∫–æ –±–∞—Ç—á–µ–π, –∑–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è.

---

## üìä –®–ê–ì 4: –ú–û–ù–ò–¢–û–†–ò–ù–ì

### 4.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤ CRON

```sql
SELECT
  j.jobname,
  d.status,
  d.start_time,
  d.end_time,
  EXTRACT(EPOCH FROM (d.end_time - d.start_time)) as duration_sec
FROM cron.job j
LEFT JOIN LATERAL (
  SELECT *
  FROM cron.job_run_details
  WHERE jobid = j.jobid
  ORDER BY end_time DESC
  LIMIT 1
) d ON true
WHERE j.jobname LIKE 'cleanup-%'
ORDER BY j.jobname;
```

### 4.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü

```sql
SELECT
  tablename,
  pg_size_pretty(pg_total_relation_size('public.' || tablename)) as size
FROM pg_tables
WHERE schemaname = 'public'
  AND tablename IN (
    'ai_reply_history',
    'logs_ai',
    'import_logs',
    'ozon_sync_history',
    'fallback_action_logs',
    'consent_logs'
  )
ORDER BY pg_total_relation_size('public.' || tablename) DESC;
```

### 4.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ CRON –∑–∞–¥–∞—á–∞—Ö —á–µ—Ä–µ–∑ Supabase Dashboard:
- Settings ‚Üí Integrations ‚Üí Webhooks

---

## üîß –£–ü–†–ê–í–õ–ï–ù–ò–ï CRON –ó–ê–î–ê–ß–ê–ú–ò

### –û—Ç–∫–ª—é—á–∏—Ç—å –∑–∞–¥–∞—á—É

```sql
-- –û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É
SELECT cron.unschedule('cleanup-logs-ai-daily');
```

### –í–∫–ª—é—á–∏—Ç—å –∑–∞–¥–∞—á—É –æ–±—Ä–∞—Ç–Ω–æ

```sql
-- –°–Ω–æ–≤–∞ —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
SELECT cron.schedule(
  'cleanup-logs-ai-daily',
  '0 5 * * *',
  $$ SELECT public.cleanup_logs_ai(); $$
);
```

### –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

```sql
-- –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –∑–∞–¥–∞—á—É
SELECT cron.unschedule('cleanup-logs-ai-daily');

-- –°–æ–∑–¥–∞—Ç—å —Å –Ω–æ–≤—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞)
SELECT cron.schedule(
  'cleanup-logs-ai-daily',
  '0 */2 * * *',
  $$ SELECT public.cleanup_logs_ai(); $$
);
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 1. –ë—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π:
- –í Supabase Dashboard: Settings ‚Üí Database ‚Üí Create backup

### 2. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ (–µ—Å–ª–∏ –º–Ω–æ–≥–æ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ

### 3. –ë–∞—Ç—á-—É–¥–∞–ª–µ–Ω–∏–µ

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞—Ç—á-—É–¥–∞–ª–µ–Ω–∏–µ:
- –£–¥–∞–ª—è—é—Ç –ø–æ 5,000 - 10,000 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑
- –î–µ–ª–∞—é—Ç –ø–∞—É–∑—É 0.1 —Å–µ–∫ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–∞—Ç—á–µ–π

### 4. –¢–∞–±–ª–∏—Ü–∞ consent_logs

–§—É–Ω–∫—Ü–∏—è `cleanup_consent_logs` —É–¥–∞–ª—è–µ—Ç **–í–°–ï** –∑–∞–ø–∏—Å–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–∞—Ç—ã.

### 5. VACUUM –ø–æ—Å–ª–µ –º–∞—Å—Å–æ–≤–æ–π –æ—á–∏—Å—Ç–∫–∏

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```sql
VACUUM ANALYZE public.ai_reply_history;
VACUUM ANALYZE public.logs_ai;
VACUUM ANALYZE public.import_logs;
-- –∏ —Ç.–¥.
```

–≠—Ç–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ –∏ –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `COMBINED_CLEANUP_MIGRATIONS.sql` | –í—Å–µ 7 –º–∏–≥—Ä–∞—Ü–∏–π –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ |
| `CHECK_CLEANUP_SETUP.sql` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –æ—á–∏—Å—Ç–∫–∏ |
| `TEST_CLEANUP_FUNCTIONS.sql` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏ |
| `–ü–†–ê–í–ò–õ–ê_–û–ß–ò–°–¢–ö–ò_–õ–û–ì–û–í_–£–¢–í–ï–†–ñ–î–ï–ù–û.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ |

---

## üÜò –£–°–¢–†–ê–ù–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –û—à–∏–±–∫–∞: "extension pg_cron does not exist"

```sql
-- –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pg_cron
CREATE EXTENSION IF NOT EXISTS pg_cron;
```

### –û—à–∏–±–∫–∞: "permission denied"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Supabase Dashboard.

### CRON –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–¥–∞—á–∏ –∞–∫—Ç–∏–≤–Ω—ã:
   ```sql
   SELECT * FROM cron.job WHERE jobname LIKE 'cleanup-%';
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
   ```sql
   SELECT * FROM cron.job_run_details
   WHERE jobid IN (SELECT jobid FROM cron.job WHERE jobname LIKE 'cleanup-%')
   ORDER BY start_time DESC LIMIT 20;
   ```

### –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ

–£–º–µ–Ω—å—à–∏—Ç–µ `v_max_batches` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ CRON.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢

- [ ] –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Å–µ 7 –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π (7 —Ñ—É–Ω–∫—Ü–∏–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ CRON –∑–∞–¥–∞—á (7 –∑–∞–¥–∞—á)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CRON –∑–∞–¥–∞—á

---

**–ì–æ—Ç–æ–≤–æ!** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é CRON.
