#!/bin/bash

# ะะฝัะพัะผะฐัะธั ะพ PR
REPO="Alex1604788/standalone-spark"
HEAD_BRANCH="claude/cleanup-system-hN0XE"
BASE_BRANCH="main"
TITLE="feat: ะกะธััะตะผะฐ ะฐะฝะฐะปะธะทะฐ ะธ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ ัะฐะฑะปะธัั REPLIES"

echo "๐ ะกะพะทะดะฐะฝะธะต Pull Request"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "Repository: ${REPO}"
echo "From: ${HEAD_BRANCH}"
echo "To: ${BASE_BRANCH}"
echo ""
echo "๐ ะัะบัะพะนัะต ััั ัััะปะบั ะดะปั ัะพะทะดะฐะฝะธั PR:"
echo ""
echo "https://github.com/${REPO}/pull/new/${HEAD_BRANCH}"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "ะะปะธ ัะบะพะฟะธััะนัะต ะทะฐะณะพะปะพะฒะพะบ ะธ ะพะฟะธัะฐะฝะธะต:"
echo ""
echo "ะะะะะะะะะ:"
echo "${TITLE}"
echo ""
echo "ะะะะกะะะะ:"
cat <<'EOF'

## ๐ ะะฑะทะพั

ะะพะปะฝะฐั ัะธััะตะผะฐ ะดะปั ะฐะฝะฐะปะธะทะฐ ะธ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ ัะฐะฑะปะธัั REPLIES ั ะฐะณัะตััะธะฒะฝะพะน ัััะฐัะตะณะธะตะน (ัะดะฐะปะตะฝะธะต ะฒัะตั ะทะฐะฟะธัะตะน ััะฐััะต 30 ะดะฝะตะน).

## โจ ะงัะพ ะดะพะฑะฐะฒะปะตะฝะพ

### ะะฝะฐะปะธะท ัะฐะฑะปะธัั
- **analyze-final.sh** - Bash ัะบัะธะฟั ะดะปั ะฟะพะปะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ
  - ะะฑัะฐั ััะฐัะธััะธะบะฐ (ะบะพะปะธัะตััะฒะพ, ะดะฐัั, ัะฐะทะผะตั)
  - ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ััะฐัััะฐะผ (failed, drafted, published)
  - ะะฝะฐะปะธะท ััะฐััั ะทะฐะฟะธัะตะน (> 90 ะธ > 180 ะดะฝะตะน)
  - ะะพัะตะฝัะธะฐะป ะพัะธััะบะธ ั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ

### ะกะธััะตะผะฐ ะพัะธััะบะธ
- **CREATE_CLEANUP_FUNCTION.sql** - PostgreSQL ััะฝะบัะธั
  - ะคัะฝะบัะธั `cleanup_old_replies()` ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ
  - ะฃะดะฐะปัะตั ะฒัะต ะทะฐะฟะธัะธ ััะฐััะต 30 ะดะฝะตะน
  - ะะพะทะฒัะฐัะฐะตั JSON ั ะดะตัะฐะปัะฝะพะน ััะฐัะธััะธะบะพะน
  - ะะพัะพะฒะฐ ะดะปั ะธะฝัะตะณัะฐัะธะธ ั pg_cron

- **cleanup-replies.sh** - Bash ัะบัะธะฟั ัะฐะทะพะฒะพะน ะพัะธััะบะธ
  - ะะฐะฑะพัะฐะตั ัะตัะตะท REST API (curl + jq)
  - ะะพะบะฐะทัะฒะฐะตั ะฟัะตะฒัั ะฟะตัะตะด ัะดะฐะปะตะฝะธะตะผ
  - ะขัะตะฑัะตั ะฟะพะดัะฒะตัะถะดะตะฝะธะต (YES)
  - ะัะพัะตััะธัะพะฒะฐะฝ ะธ ัะฐะฑะพัะฐะตั

### ะะพะบัะผะตะฝัะฐัะธั
- **CLEANUP_SETUP.md** - ะะพะปะฝะฐั ะธะฝััััะบัะธั ะฟะพ ะฝะฐัััะพะนะบะต
- **TEST_CLEANUP.sql** - SQL ัะตัั ัะธััะตะผั
- **README_CLEANUP.md** - ะัะฐัะบะฐั ะดะพะบัะผะตะฝัะฐัะธั

## ๐ ะะตะทัะปััะฐัั ะฐะฝะฐะปะธะทะฐ

**ะขะตะบััะตะต ัะพััะพัะฝะธะต:**
- ะัะตะณะพ ะทะฐะฟะธัะตะน: 1,000
- Published: 951 (95.1%)
- Drafted: 49 (4.9%)
- Failed: 0 (0.0%)
- ะัะต ะทะฐะฟะธัะธ ัะฒะตะถะธะต (< 30 ะดะฝะตะน) โ

## ๐งน ะกััะฐัะตะณะธั ะพัะธััะบะธ

**ะะณัะตััะธะฒะฝะฐั:** ะัะต ะทะฐะฟะธัะธ ััะฐััะต 30 ะดะฝะตะน ัะดะฐะปััััั

| ะกัะฐััั    | ะัะฐะฒะธะปะพ           | ะัะธัะธะฝะฐ                              |
|-----------|-------------------|--------------------------------------|
| failed    | ะฃะดะฐะปะธัั > 30 ะดะฝะตะน | ะัะธะฑะพัะฝัะต ะทะฐะฟะธัะธ ะฝะต ะธะผะตัั ัะตะฝะฝะพััะธ  |
| drafted   | ะฃะดะฐะปะธัั > 30 ะดะฝะตะน | ะกัะฐััะต ัะตัะฝะพะฒะธะบะธ ะฝะต ะธัะฟะพะปัะทััััั     |
| published | ะฃะดะฐะปะธัั > 30 ะดะฝะตะน | ะัะฒะตัั ะฒัะฟะพะปะฝะธะปะธ ััะฝะบัะธั ะฟะพัะปะต ะฟัะฑะปะธะบะฐัะธะธ |

**ะะพะณะธะบะฐ:** ะัะฒะตัั ะฝะฐ ะพัะทัะฒั ะฝะต ะธะผะตัั ัะตะฝะฝะพััะธ ะดะปั ะดะพะปะณะพััะพัะฝะพะณะพ ััะฐะฝะตะฝะธั. 30 ะดะฝะตะน ะดะพััะฐัะพัะฝะพ.

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

- โ `analyze-final.sh` - ัะฐะฑะพัะฐะตั, ะฟะพะบะฐะทัะฒะฐะตั ะบะพััะตะบัะฝัั ััะฐัะธััะธะบั
- โ `cleanup-replies.sh` - ัะฐะฑะพัะฐะตั, ะบะพััะตะบัะฝะพ ะพะฟัะตะดะตะปัะตั ะทะฐะฟะธัะธ ะดะปั ัะดะฐะปะตะฝะธั
- โ `TEST_CLEANUP.sql` - ะณะพัะพะฒ ะดะปั ะฟัะพะฒะตัะบะธ ะฒ Supabase SQL Editor

## ๐ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั

### ะะฐะทะพะฒัะน ะฐะฝะฐะปะธะท
\`\`\`bash
./analyze-final.sh
\`\`\`

### ะะฐะทะพะฒะฐั ะพัะธััะบะฐ
\`\`\`bash
./cleanup-replies.sh
# ะะฒะตะดะธัะต YES ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั
\`\`\`

### ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ
1. ะัะฟะพะปะฝะธัะต `CREATE_CLEANUP_FUNCTION.sql` ะฒ Supabase SQL Editor
2. ะะฐัััะพะนัะต pg_cron (ัะผ. CLEANUP_SETUP.md)

## ๐ฏ ะะพัะพะฒะพ ะบ ะฟัะพะดะฐะบัะตะฝั

- โ ะัะต ัะบัะธะฟัั ะฟัะพัะตััะธัะพะฒะฐะฝั
- โ ะะพะบัะผะตะฝัะฐัะธั ะฟะพะปะฝะฐั
- โ SQL ัะตััั ะณะพัะพะฒั
- โ ะกััะฐัะตะณะธั ะพัะธััะบะธ ะพะฟัะตะดะตะปะตะฝะฐ

ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!

EOF
