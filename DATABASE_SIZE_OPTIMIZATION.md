# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase

## –¶–µ–ª—å

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ Supabase (500 –ú–ë).

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ Supabase:
# https://supabase.com/dashboard/project/nxymhkyvhcfcwjcfcbfy/sql/new

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ CHECK_DATABASE_SIZE.sql –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
```

**–§–∞–π–ª:** `CHECK_DATABASE_SIZE.sql`

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã (—Ç–æ–ø-20 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö)
- –î–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º `reviews` –∏ `replies`
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É

### 2Ô∏è‚É£ –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –ë–î > 400 –ú–ë - –°–†–û–ß–ù–û –æ—á–∏—Å—Ç–∏—Ç—å

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ –ë–î:**

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
# supabase/migrations/20260220_create_cleanup_old_reviews_function.sql
# –í—Å—Ç–∞–≤—å—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É:**

```sql
-- –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 180 –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
SELECT public.cleanup_old_reviews();

-- –ò–õ–ò —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)
SELECT public.cleanup_old_reviews(90);
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```sql
SELECT
  COUNT(*) as remaining_reviews,
  pg_size_pretty(pg_total_relation_size('public.reviews')) as table_size
FROM reviews;
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è)

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: DELETE_OLD_REVIEWS_MANUAL.sql
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ —Ñ–∞–π–ª–µ (–µ—Å—Ç—å 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è)
```

**–§–∞–π–ª:** `DELETE_OLD_REVIEWS_MANUAL.sql`

–í–∞—Ä–∏–∞–Ω—Ç—ã:
1. –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 180 –¥–Ω–µ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
2. –£–¥–∞–ª–∏—Ç—å —Ä–æ–≤–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—É —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
3. –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)

### 3Ô∏è‚É£ –û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ (–í–ê–ñ–ù–û!)

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å VACUUM –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞:

```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—ã—á–Ω—ã–π VACUUM (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É, ~5-10 –º–∏–Ω—É—Ç)
VACUUM ANALYZE reviews;
VACUUM ANALYZE replies;

-- –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω—ã–π VACUUM (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É, –Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º –º–µ—Å—Ç–∞)
-- ‚ö†Ô∏è –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è!
VACUUM FULL ANALYZE reviews;
VACUUM FULL ANALYZE replies;
```

### 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ë–î
SELECT pg_size_pretty(pg_database_size(current_database())) as database_size;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
SELECT
  'reviews' as table_name,
  pg_size_pretty(pg_total_relation_size('public.reviews')) as size
UNION ALL
SELECT
  'replies' as table_name,
  pg_size_pretty(pg_total_relation_size('public.replies')) as size;
```

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pg_cron (—Ç–æ–ª—å–∫–æ –Ω–∞ –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–∞—Ö Supabase)

```sql
-- 1. –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
CREATE EXTENSION IF NOT EXISTS pg_cron;

-- 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—É—é –æ—á–∏—Å—Ç–∫—É (1-–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ 02:00 UTC)
SELECT cron.schedule(
    'cleanup-old-reviews-monthly',
    '0 2 1 * *',
    $$ SELECT public.cleanup_old_reviews(180); $$
);

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞
SELECT * FROM cron.job WHERE jobname = 'cleanup-old-reviews-monthly';

-- 4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
SELECT *
FROM cron.job_run_details
WHERE job_name = 'cleanup-old-reviews-monthly'
ORDER BY start_time DESC
LIMIT 5;
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü

–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ pg_cron, –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü:

```sql
SELECT public.cleanup_old_reviews(180);
VACUUM ANALYZE reviews;
VACUUM ANALYZE replies;
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

- **Reviews (–æ—Ç–∑—ã–≤—ã):** –•—Ä–∞–Ω–∏–º 180 –¥–Ω–µ–π (6 –º–µ—Å—è—Ü–µ–≤)
- **Replies (–æ—Ç–≤–µ—Ç—ã):** –•—Ä–∞–Ω–∏–º 30 –¥–Ω–µ–π (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ `cleanup_old_replies()`)

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

1. **–û—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤** –Ω–µ –∏–º–µ—é—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏:
   - –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
   - –ó–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞

2. **–û—Ç–≤–µ—Ç—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π** —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã:
   - –ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–µ –Ω—É–∂–Ω—ã –≤ –ë–î
   - –í—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –µ—â–µ –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞

–ú–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è:

```sql
-- –•—Ä–∞–Ω–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Ç–æ–ª—å–∫–æ 90 –¥–Ω–µ–π (3 –º–µ—Å—è—Ü–∞)
SELECT public.cleanup_old_reviews(90);

-- –•—Ä–∞–Ω–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Ç–æ–ª—å–∫–æ 60 –¥–Ω–µ–π (2 –º–µ—Å—è—Ü–∞)
SELECT public.cleanup_old_reviews(60);
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ –ë–î

### –°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–∑–º–µ—Ä –ë–î —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é:

```sql
-- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
SELECT
  pg_size_pretty(pg_database_size(current_database())) as db_size,
  CASE
    WHEN pg_database_size(current_database()) > 524288000 THEN '‚ö†Ô∏è –ü–†–ï–í–´–®–ï–ù –õ–ò–ú–ò–¢!'
    WHEN pg_database_size(current_database()) > 419430400 THEN '‚ö†Ô∏è > 80%'
    WHEN pg_database_size(current_database()) > 314572800 THEN '‚ö†Ô∏è > 60%'
    ELSE '‚úÖ OK'
  END as status;
```

### –°—Ç–∞—Ç—É—Å-–¥–æ—Å–∫–∞

| –†–∞–∑–º–µ—Ä –ë–î | –°—Ç–∞—Ç—É—Å | –î–µ–π—Å—Ç–≤–∏–µ |
|-----------|--------|----------|
| < 300 –ú–ë | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å |
| 300-400 –ú–ë | ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—á–∏—Å—Ç–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ |
| 400-450 –ú–ë | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ | –û—á–∏—Å—Ç–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 2-3 –¥–Ω–µ–π |
| > 450 –ú–ë | üö® –°–†–û–ß–ù–û | –û—á–∏—Å—Ç–∏—Ç—å –ù–ï–ú–ï–î–õ–ï–ù–ù–û |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

- **`CHECK_DATABASE_SIZE.sql`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ë–î –∏ —Ç–∞–±–ª–∏—Ü
- **`supabase/migrations/20260220_create_cleanup_old_reviews_function.sql`** - –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏
- **`DELETE_OLD_REVIEWS_MANUAL.sql`** - –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
- **`DATABASE_SIZE_OPTIMIZATION.md`** - –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏:

1. **`cleanup_old_replies()`** - –£–¥–∞–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
   - –§–∞–π–ª: `CREATE_CLEANUP_FUNCTION.sql`
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `CLEANUP_SETUP.md`

2. **`cleanup_old_reviews(days_threshold)`** - –£–¥–∞–ª—è–µ—Ç –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π
   - –§–∞–π–ª: `supabase/migrations/20260220_create_cleanup_old_reviews_function.sql`
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 180 –¥–Ω–µ–π

## –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞ —á–µ—Ä–µ–∑ `cleanup_old_reviews()`:

- ‚úÖ **–°–∞–º –æ—Ç–∑—ã–≤** (—Ç–∞–±–ª–∏—Ü–∞ `reviews`)
- ‚úÖ **–°–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** (—Ç–∞–±–ª–∏—Ü–∞ `replies`, CASCADE)
- ‚ö†Ô∏è **product_knowledge.source_review_id** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ NULL (–µ—Å–ª–∏ –±—ã–ª)

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è!

–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Supabase –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω)
2. –ò–õ–ò —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ S3/–¥—Ä—É–≥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
3. –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `DELETE_OLD_REVIEWS_MANUAL.sql` —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π (BEGIN/COMMIT)

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ VACUUM —Ä–∞–∑–º–µ—Ä –Ω–µ —É–º–µ–Ω—å—à–∏–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `VACUUM FULL` –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ `VACUUM`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: `SELECT * FROM pg_stat_activity;`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –≤—Å–µ –µ—â–µ > 450 –ú–ë

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü: `CHECK_DATABASE_SIZE.sql`
2. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ `import_logs`: `DELETE FROM import_logs WHERE created_at < NOW() - INTERVAL '30 days';`
3. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ `ozon_performance_daily`: `DELETE FROM ozon_performance_daily WHERE date < NOW() - INTERVAL '90 days';`
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤ –¥–æ 90 –¥–Ω–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞: –§—É–Ω–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ä–æ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQL Editor –≤ Supabase (–Ω–µ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö)
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "permission denied", –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Service Role Key

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Supabase: https://supabase.com/docs/guides/platform/database-size
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PostgreSQL VACUUM: https://www.postgresql.org/docs/current/sql-vacuum.html
- –ü—Ä–æ–µ–∫—Ç: standalone-spark
- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2026-02-20

---

**–ê–≤—Ç–æ—Ä:** Claude (AI Assistant)
**–í–µ—Ä—Å–∏—è:** 1.0
