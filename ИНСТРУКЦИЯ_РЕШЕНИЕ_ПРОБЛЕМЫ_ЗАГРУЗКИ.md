# üö® –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´: –î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è"

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ **"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è"** –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–ó–∞–≥—Ä—É–∑–∫–∞..." –∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è.

## –ü—Ä–∏—á–∏–Ω–∞

VIEW `ozon_performance_summary` –Ω–µ –±—ã–ª –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Supabase, —Ö–æ—Ç—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ñ–∞–π–ª–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞.

---

## ‚ö° –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï (2 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ:
```
https://supabase.com/dashboard/project/bkmicyguzlwampuindff/sql/new
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
```
–ü–†–ò–ú–ï–ù–ò–¢–¨_VIEW_–ü–†–Ø–ú–û_–°–ï–ô–ß–ê–°.sql
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –Ω–∏–∂–µ.

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

1. –ù–∞–∂–º–∏—Ç–µ **F5** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª **"–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è"**
3. –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è!

---

## üìã –ì–æ—Ç–æ–≤—ã–π SQL —Å–∫—Ä–∏–ø—Ç (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ Supabase SQL Editor)

```sql
-- –®–∞–≥ 1: –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è orders_model –∏ revenue_model (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)
ALTER TABLE public.ozon_performance_daily
  ADD COLUMN IF NOT EXISTS orders_model INTEGER DEFAULT 0,
  ADD COLUMN IF NOT EXISTS revenue_model DECIMAL(10, 2);

-- –®–∞–≥ 2: –°–æ–∑–¥–∞–µ–º VIEW
DROP VIEW IF EXISTS public.ozon_performance_summary CASCADE;

CREATE OR REPLACE VIEW public.ozon_performance_summary AS
SELECT
  id,
  marketplace_id,
  stat_date,
  sku,
  offer_id,
  campaign_id,
  campaign_name,
  campaign_type,
  money_spent,
  views,
  clicks,
  orders,
  orders_model,
  revenue,
  revenue_model,
  add_to_cart,
  add_to_cart_conversion,
  favorites,
  avg_bill,

  -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
  (COALESCE(orders, 0) + COALESCE(orders_model, 0)) AS total_orders,
  (COALESCE(revenue, 0) + COALESCE(revenue_model, 0)) AS total_revenue,

  -- –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  CASE WHEN views > 0 THEN ROUND((clicks::NUMERIC / views) * 100, 2) ELSE 0 END AS ctr,
  CASE WHEN clicks > 0 THEN ROUND(money_spent / clicks, 2) ELSE 0 END AS cpc,
  CASE WHEN clicks > 0 THEN ROUND(((COALESCE(orders, 0) + COALESCE(orders_model, 0))::NUMERIC / clicks) * 100, 2) ELSE 0 END AS conversion,
  CASE
    WHEN (COALESCE(revenue, 0) + COALESCE(revenue_model, 0)) > 0
    THEN ROUND((money_spent / (COALESCE(revenue, 0) + COALESCE(revenue_model, 0))) * 100, 2)
    ELSE NULL
  END AS drr,

  imported_at,
  import_batch_id
FROM public.ozon_performance_daily;

-- –®–∞–≥ 3: –î–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
GRANT SELECT ON public.ozon_performance_summary TO authenticated;
GRANT SELECT ON public.ozon_performance_summary TO anon;

-- –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT
  '‚úÖ VIEW —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!' as result,
  COUNT(*) as total_records
FROM ozon_performance_summary;
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ—Ç)

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è VIEW, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```
–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_–ó–ê–ì–†–£–ó–ö–ò_–ü–†–û–î–í–ò–ñ–ï–ù–ò–Ø.sql
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

#### 1. –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ `ozon_performance_daily`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT COUNT(*) FROM ozon_performance_daily;
```

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é OZON Performance –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
- –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API OZON –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è**
- –ù–∞–∂–º–∏—Ç–µ **"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å"**

#### 2. –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –Ω–æ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ marketplace_id

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT
  m.id as marketplace_id,
  m.name,
  COUNT(opd.id) as records
FROM marketplaces m
LEFT JOIN ozon_performance_daily opd ON opd.marketplace_id = m.id
WHERE m.user_id = auth.uid()
GROUP BY m.id, m.name;
```

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –ø–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

#### 3. –ü–µ—Ä–∏–æ–¥ –¥–∞—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT MIN(stat_date), MAX(stat_date)
FROM ozon_performance_daily;
```

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 180 –¥–Ω–µ–π).

---

## üìÅ –§–∞–π–ª—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

1. **–ü–†–ò–ú–ï–ù–ò–¢–¨_VIEW_–ü–†–Ø–ú–û_–°–ï–ô–ß–ê–°.sql** - –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è VIEW
2. **–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_–ó–ê–ì–†–£–ó–ö–ò_–ü–†–û–î–í–ò–ñ–ï–ù–ò–Ø.sql** - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã
3. **CHECK_PROMOTIONS_DATA.sql** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞:

1. **–í SQL Editor –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**
   ```
   ‚úÖ VIEW —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!
   total_records: [—á–∏—Å–ª–æ > 0]
   ```

2. **–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
   - –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
   - –û—Ç–∫—Ä–æ–π—Ç–µ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è"
   - –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —Å–µ–∫—É–Ω–¥

3. **–ï—Å–ª–∏ total_records = 0:**
   - VIEW —Å–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ù–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (—Å–º. –ø—É–Ω–∫—Ç 1 –≤ —Ä–∞–∑–¥–µ–ª–µ "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞")

---

## üõ†Ô∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Git

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Git (–¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è):

```bash
# –≠—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:
# 1. 20260108000000_add_model_orders_revenue.sql
# 2. 20260112000000_create_ozon_performance_summary_view.sql

# –ú–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
```

---

## üìû –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏–∑ —Ñ–∞–π–ª–∞ `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_–ó–ê–ì–†–£–ó–ö–ò_–ü–†–û–î–í–ò–ñ–ï–ù–ò–Ø.sql`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API –∫–ª—é—á–∏ OZON –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

**‚ö° –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ VIEW –∑–∞–π–º–µ—Ç 2 –º–∏–Ω—É—Ç—ã –∏ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É! ‚ö°**
