# üìä –ê–ù–ê–õ–ò–ó –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–•

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-01-25
**–¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –ë–î:** ~933 rows / ~500-600 MB (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)

---

## üîç –¢–ï–ö–£–©–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø

### –°–∞–º—ã–µ –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã (–ø–æ —Å–∫—Ä–∏–Ω—à–æ—Ç—É):

| ‚Ññ | –¢–∞–±–ª–∏—Ü–∞ | –†–∞–∑–º–µ—Ä | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –°—Ç–∞—Ç—É—Å –æ—á–∏—Å—Ç–∫–∏ |
|---|---------|--------|------------|----------------|
| 1 | **replicas** | 337 MB | –°–∏—Å—Ç–µ–º–Ω–∞—è (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è) | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è |
| 2 | **saor_accruals** | 70 MB | –ù–∞—á–∏—Å–ª–µ–Ω–∏—è OZON | ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ |
| 3 | **audit_log** | 63 MB | –õ–æ–≥–∏ –∞—É–¥–∏—Ç–∞ | ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ |
| 4 | **job_run_details** | 54 MB | –õ–æ–≥–∏ CRON | ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ (7 –¥–Ω–µ–π) |
| 5 | **reviews** | 32 MB | –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ | ‚ö†Ô∏è –ë–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ |
| 6 | **storage_costs** | 24 MB | –°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è | ‚ö†Ô∏è –ë–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ |

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. **replicas** (337 MB) - –°–ò–°–¢–ï–ú–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

**–ß—Ç–æ —ç—Ç–æ:**
- –°–∏—Å—Ç–µ–º–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Supabase –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å WAL (Write-Ahead Log) –¥–∞–Ω–Ω—ã–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```sql
-- üîç –ò–°–°–õ–ï–î–û–í–ê–¢–¨: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è
SELECT
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE tablename = 'replicas'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d+ replicas
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ Supabase
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å
- ‚ö†Ô∏è –ù–ï –£–î–ê–õ–Ø–¢–¨ –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å Supabase support

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í–´–°–û–ö–ò–ô (—Å–∞–º–∞—è –±–æ–ª—å—à–∞—è —Ç–∞–±–ª–∏—Ü–∞)

---

### 2. **saor_accruals** (70 MB) - –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø

**–ß—Ç–æ —ç—Ç–æ:**
- –í–µ—Ä–æ—è—Ç–Ω–æ, —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π/–∫–æ–º–∏—Å—Å–∏–π –æ—Ç OZON
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚ùå –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–π –≤ `supabase/migrations/`
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ TypeScript)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (90+ –¥–Ω–µ–π)
```sql
-- 1. –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
CREATE TABLE IF NOT EXISTS public.saor_accruals_archive (
  LIKE public.saor_accruals INCLUDING ALL
);

-- 2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (> 90 –¥–Ω–µ–π)
INSERT INTO public.saor_accruals_archive
SELECT * FROM public.saor_accruals
WHERE created_at < NOW() - INTERVAL '90 days';

-- 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
DELETE FROM public.saor_accruals
WHERE created_at < NOW() - INTERVAL '90 days';

-- 4. VACUUM –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞
VACUUM FULL public.saor_accruals;
```

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~40-50 MB

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ï—Å–ª–∏ –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –Ω—É–∂–Ω–∞, –º–æ–∂–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º
CREATE TABLE public.saor_accruals_summary AS
SELECT
  DATE_TRUNC('week', created_at) as week,
  marketplace_id,
  SUM(amount) as total_amount,
  COUNT(*) as transactions_count
FROM public.saor_accruals
GROUP BY 1, 2;
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –°–†–ï–î–ù–ò–ô

---

### 3. **audit_log** (63 MB) - –õ–û–ì–ò –ê–£–î–ò–¢–ê

**–ß—Ç–æ —ç—Ç–æ:**
- –¢–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `user_id`, `action`, `entity_type`, `entity_id`, `details`, `created_at`

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ `20251003031058`
- ‚ùå –ù–ï–¢ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É (—Ö—Ä–∞–Ω–∏—Ç—å 90 –¥–Ω–µ–π)

```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è: supabase/migrations/20260125120700_cleanup_audit_log.sql

CREATE EXTENSION IF NOT EXISTS pg_cron;

-- –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ audit_log
CREATE OR REPLACE FUNCTION public.cleanup_audit_log()
RETURNS TABLE (
  deleted_count BIGINT,
  total_time_ms BIGINT,
  batches_processed INT
)
LANGUAGE plpgsql
AS $$
DECLARE
  v_deleted_count BIGINT := 0;
  v_batch_count INT := 0;
  v_rows_deleted INT;
  v_start_time TIMESTAMP;
  v_cutoff_date TIMESTAMPTZ;
  v_max_batches INT := 100;
BEGIN
  v_start_time := clock_timestamp();
  v_cutoff_date := NOW() - INTERVAL '90 days'; -- 3 –º–µ—Å—è—Ü–∞

  RAISE NOTICE '–ù–∞—á–∏–Ω–∞–µ–º –æ—á–∏—Å—Ç–∫—É audit_log —Å—Ç–∞—Ä—à–µ %', v_cutoff_date;

  LOOP
    DELETE FROM public.audit_log
    WHERE id IN (
      SELECT id
      FROM public.audit_log
      WHERE created_at < v_cutoff_date
      ORDER BY created_at ASC
      LIMIT 10000
    );

    GET DIAGNOSTICS v_rows_deleted = ROW_COUNT;
    EXIT WHEN v_rows_deleted = 0;

    v_deleted_count := v_deleted_count + v_rows_deleted;
    v_batch_count := v_batch_count + 1;

    RAISE NOTICE '–ë–∞—Ç—á %: —É–¥–∞–ª–µ–Ω–æ % –∑–∞–ø–∏—Å–µ–π (–≤—Å–µ–≥–æ: %)',
      v_batch_count, v_rows_deleted, v_deleted_count;

    PERFORM pg_sleep(0.1);
    EXIT WHEN v_batch_count >= v_max_batches;
  END LOOP;

  IF v_deleted_count > 1000 THEN
    EXECUTE 'ANALYZE public.audit_log';
  END IF;

  deleted_count := v_deleted_count;
  total_time_ms := EXTRACT(EPOCH FROM (clock_timestamp() - v_start_time)) * 1000;
  batches_processed := v_batch_count;

  RETURN NEXT;
END;
$$;

-- CRON job (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 03:00 UTC)
SELECT cron.schedule(
  'cleanup-audit-log-weekly',
  '0 3 * * 0',
  $$ SELECT public.cleanup_audit_log(); $$
);
```

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~40-50 MB (–ø–æ—Å–ª–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –°–†–ï–î–ù–ò–ô-–í–´–°–û–ö–ò–ô

---

### 4. **job_run_details** (54 MB) - –õ–û–ì–ò CRON

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–ñ–ï –ù–ê–°–¢–†–û–ï–ù–ê –ê–í–¢–û–û–ß–ò–°–¢–ö–ê
- –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 –¥–Ω–µ–π
- CRON: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 06:00 UTC
- –ú–∏–≥—Ä–∞—Ü–∏—è: `20260125120400_cleanup_cron_job_run_details.sql`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- ‚úÖ –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- üìä –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

---

### 5. **reviews** (32 MB) - –û–¢–ó–´–í–´

**–ß—Ç–æ —ç—Ç–æ:**
- –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ —Ç–æ–≤–∞—Ä—ã
- –ë–∏–∑–Ω–µ—Å-–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚ö†Ô∏è –≠—Ç–æ –ù–ï –ª–æ–≥–∏, –∞ –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ
- ‚ùå –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 1: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ (> 2 –≥–æ–¥–∞)
```sql
-- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–µ –æ—Ç–∑—ã–≤—ã –≤ –∞—Ä—Ö–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
CREATE TABLE public.reviews_archive (
  LIKE public.reviews INCLUDING ALL
);

-- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 2 –ª–µ—Ç
INSERT INTO public.reviews_archive
SELECT * FROM public.reviews
WHERE review_date < NOW() - INTERVAL '2 years';

-- –£–¥–∞–ª–∏—Ç—å –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
DELETE FROM public.reviews
WHERE review_date < NOW() - INTERVAL '2 years';
```

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~10-15 MB

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 2: –°–∂–∞—Ç–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
```sql
-- –ï—Å–ª–∏ –µ—Å—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã, –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä
ALTER TABLE public.reviews
  ALTER COLUMN text TYPE TEXT,
  ALTER COLUMN advantages TYPE TEXT,
  ALTER COLUMN disadvantages TYPE TEXT;

-- –î–æ–±–∞–≤–∏—Ç—å CHECK constraint –Ω–∞ —Ä–∞–∑–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, max 5000 —Å–∏–º–≤–æ–ª–æ–≤)
ALTER TABLE public.reviews
  ADD CONSTRAINT reviews_text_length CHECK (LENGTH(text) <= 5000);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –ù–ò–ó–ö–ò–ô (–±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

---

### 6. **storage_costs** (24 MB) - –°–¢–û–ò–ú–û–°–¢–¨ –•–†–ê–ù–ï–ù–ò–Ø

**–ß—Ç–æ —ç—Ç–æ:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ OZON
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `cost_date`, `offer_id`, `storage_cost`, `stock_quantity`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è 1: –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤
```sql
-- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (> 6 –º–µ—Å—è—Ü–µ–≤)
CREATE OR REPLACE FUNCTION public.cleanup_storage_costs()
RETURNS TABLE (deleted_count BIGINT)
LANGUAGE plpgsql
AS $$
DECLARE
  v_deleted_count BIGINT := 0;
BEGIN
  DELETE FROM public.storage_costs
  WHERE cost_date < CURRENT_DATE - INTERVAL '6 months';

  GET DIAGNOSTICS v_deleted_count = ROW_COUNT;

  IF v_deleted_count > 0 THEN
    ANALYZE public.storage_costs;
  END IF;

  deleted_count := v_deleted_count;
  RETURN NEXT;
END;
$$;

-- CRON job (–µ–∂–µ–º–µ—Å—è—á–Ω–æ, 1 —á–∏—Å–ª–∞ –≤ 02:00 UTC)
SELECT cron.schedule(
  'cleanup-storage-costs-monthly',
  '0 2 1 * *',
  $$ SELECT public.cleanup_storage_costs(); $$
);
```

**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~10-12 MB

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –ù–ò–ó–ö–ò–ô-–°–†–ï–î–ù–ò–ô

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (–ü–†–ò–û–†–ò–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–ô)

### –≠—Ç–∞–ø 1: –°–†–û–ß–ù–û (—ç–∫–æ–Ω–æ–º–∏—è ~40-50 MB)
1. ‚úÖ **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É replicas**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
   - –°–≤—è–∑–∞—Ç—å—Å—è —Å Supabase support –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

2. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É audit_log** (90 –¥–Ω–µ–π)
   - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –±–∞–∑–µ
   - –û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è: 40-50 MB

### –≠—Ç–∞–ø 2: –í–ê–ñ–ù–û (—ç–∫–æ–Ω–æ–º–∏—è ~50-60 MB)
3. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å saor_accruals**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω—É–∂–Ω–∞ –ª–∏ —ç—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (> 90 –¥–Ω–µ–π)
   - –û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è: 40-50 MB

4. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—á–∏—Å—Ç–∫—É storage_costs** (6 –º–µ—Å—è—Ü–µ–≤)
   - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –±–∞–∑–µ
   - –û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è: 10-12 MB

### –≠—Ç–∞–ø 3: –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û (—ç–∫–æ–Ω–æ–º–∏—è ~10-15 MB)
5. üîÑ **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ reviews** (> 2 –≥–æ–¥–∞)
   - –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ –º–µ—Å—Ç–æ
   - –ë–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
   - –û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è: 10-15 MB

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|------------|-----|-------|-----------|
| –†–∞–∑–º–µ—Ä –ë–î | ~600 MB | ~450-500 MB | **-100-150 MB (-20-25%)** |
| –¢–∞–±–ª–∏—Ü–∞ replicas | 337 MB | ??? | –¢—Ä–µ–±—É–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è |
| –¢–∞–±–ª–∏—Ü–∞ saor_accruals | 70 MB | ~20-30 MB | **-40-50 MB** |
| –¢–∞–±–ª–∏—Ü–∞ audit_log | 63 MB | ~10-20 MB | **-40-50 MB** |
| –¢–∞–±–ª–∏—Ü–∞ storage_costs | 24 MB | ~12-15 MB | **-10-12 MB** |
| –¢–∞–±–ª–∏—Ü–∞ reviews | 32 MB | ~20-25 MB | **-10-15 MB** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

---

## üõ†Ô∏è –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ò–Ω–¥–µ–∫—Å—ã
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
SELECT
  schemaname,
  tablename,
  indexname,
  pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
  idx_scan as index_scans
FROM pg_stat_user_indexes
WHERE idx_scan = 0
  AND schemaname = 'public'
ORDER BY pg_relation_size(indexrelid) DESC;

-- –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã (–æ—Å–≤–æ–±–æ–¥–∏—Ç –º–µ—Å—Ç–æ)
-- DROP INDEX IF EXISTS index_name;
```

### 2. VACUUM –∏ ANALYZE
```sql
-- –†–µ–≥—É–ª—è—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å VACUUM –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞
VACUUM (VERBOSE, ANALYZE) public.audit_log;
VACUUM (VERBOSE, ANALYZE) public.saor_accruals;
VACUUM (VERBOSE, ANALYZE) public.storage_costs;

-- –ò–ª–∏ VACUUM FULL –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É!)
-- VACUUM FULL public.audit_log;
```

### 3. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
–î–ª—è —Ç–∞–±–ª–∏—Ü —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (audit_log, storage_costs):
```sql
-- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º/–≥–æ–¥–∞–º
-- –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```sql
-- –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü
CREATE OR REPLACE VIEW public.table_sizes AS
SELECT
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size,
  pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) AS table_size,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename) - pg_relation_size(schemaname||'.'||tablename)) AS indexes_size,
  pg_total_relation_size(schemaname||'.'||tablename) AS bytes
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
SELECT * FROM public.table_sizes;
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø

- [ ] –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `replicas` (337 MB)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ `audit_log` (90 –¥–Ω–µ–π)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `audit_log`
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—É–¥—å–±—É —Ç–∞–±–ª–∏—Ü—ã `saor_accruals`
- [ ] –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `saor_accruals` (> 90 –¥–Ω–µ–π)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ `storage_costs` (6 –º–µ—Å—è—Ü–µ–≤)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `storage_costs`
- [ ] –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å VACUUM –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Claude Code
**–î–∞—Ç–∞:** 2026-01-25
**–í–µ—Ä—Å–∏—è:** 1.0
