# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ª–∏–º–∏—Ç–∞ 1000 –∑–∞–ø–∏—Å–µ–π –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `ozon_performance_summary`:
- **–ó–∞–≥—Ä—É–∂–∞–ª–æ—Å—å –º–∞–∫—Å–∏–º—É–º 1000 –∑–∞–ø–∏—Å–µ–π** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Supabase –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ï—Å–ª–∏ —É –≤–∞—Å –±—ã–ª–æ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, —á–∞—Å—Ç—å —Ç–µ—Ä—è–ª–∞—Å—å
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
  - ‚ùå –ù–µ–ø–æ–ª–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º
  - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å—É–º–º–∞–º —Ä–∞—Å—Ö–æ–¥–æ–≤
  - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–Ω–µ–π (–ø–æ–∫–∞–∑—ã–≤–∞–ª–æ `days: 1` –≤–º–µ—Å—Ç–æ `days: 7`)
  - ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏–∑-–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–í–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –±—Ä–∞—É–∑–µ—Ä –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤ JavaScript, —Ç–µ–ø–µ—Ä—å:
1. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL** - –±—ã—Å—Ç—Ä–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ
2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ (campaign_id, stat_date)** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—É–º–º—ã
3. **–¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é** - –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ –∫–∞–º–ø–∞–Ω–∏–∏
4. **–ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –í–°–ï –¥–∞–Ω–Ω—ã–µ

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `APPLY_CAMPAIGN_AGGREGATION_MIGRATIONS.sql`
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å SQL –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
6. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl+Enter)

‚úÖ –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "Success. No rows returned"

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
SELECT routine_name, routine_type
FROM information_schema.routines
WHERE routine_schema = 'public'
  AND routine_name IN (
    'get_campaign_performance_aggregated',
    'get_product_performance_by_campaign'
  );
```

‚úÖ –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 2 —Å—Ç—Ä–æ–∫–∏ —Å —ç—Ç–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:

```sql
-- –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π
SELECT
  campaign_name,
  total_money_spent,
  days_with_expenses,
  sku_count,
  total_orders,
  total_revenue
FROM get_campaign_performance_aggregated(
  'YOUR_MARKETPLACE_ID'::uuid,  -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à marketplace_id
  '2025-12-01'::date,
  '2025-12-31'::date
)
ORDER BY total_money_spent DESC
LIMIT 5;
```

–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_MARKETPLACE_ID` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `marketplaces`.

‚úÖ –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

–ö–æ–¥ React —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ–º–º–∏—Ç–µ. –ü—Ä–æ—Å—Ç–æ:
1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ –∫–∞–º–ø–∞–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã

## üîç –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### –î–æ (—Å—Ç–∞—Ä—ã–π –∫–æ–¥):
```typescript
// –ó–∞–≥—Ä—É–∂–∞–ª–∏ –í–°–ï —Å—ã—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (–º–∞–∫—Å–∏–º—É–º 1000)
const { data } = await supabase
  .from("ozon_performance_summary")
  .select("*")
  .eq("marketplace_id", id)
  .gte("stat_date", startDate)
  .lte("stat_date", endDate);

// –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–ª–∏ –≤ JavaScript (–º–µ–¥–ª–µ–Ω–Ω–æ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ 1000 –∑–∞–ø–∏—Å—è–º–∏)
const campaigns = aggregateInJS(data);
```

### –ü–æ—Å–ª–µ (–Ω–æ–≤—ã–π –∫–æ–¥):
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º SQL-—Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
const { data } = await supabase
  .rpc("get_campaign_performance_aggregated", {
    p_marketplace_id: id,
    p_start_date: startDate,
    p_end_date: endDate,
  });

// –î–∞–Ω–Ω—ã–µ —É–∂–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω—ã, –≥–æ—Ç–æ–≤—ã –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é!
// –ù–ï–¢ –ª–∏–º–∏—Ç–∞, –í–°–ï –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∏–∑ –≤–∞—à–∏—Ö –ª–æ–≥–æ–≤):
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 1000  ‚ùå –õ–∏–º–∏—Ç!
üí∞ –°–∏—Ñ–æ–Ω D240: {days: 1, total: 594.61}  ‚ùå –¢–æ–ª—å–∫–æ 1 –¥–µ–Ω—å
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–∞–º–ø–∞–Ω–∏–π: 53  ‚úÖ –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ SQL
üí∞ –°–∏—Ñ–æ–Ω D240: {days: 7, total: 3889.26}  ‚úÖ –í—Å–µ 7 –¥–Ω–µ–π
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|----------------|-----|--------|
| –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π | ‚ùå 1000 | ‚úÖ –ë–µ–∑ –ª–∏–º–∏—Ç–∞ |
| –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ | ‚ö° –ë—ã—Å—Ç—Ä–æ |
| –¢–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö | ‚ùå –ù–µ–ø–æ–ª–Ω—ã–µ | ‚úÖ –ü–æ–ª–Ω—ã–µ |
| –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ | ‚ùå –í JS | ‚úÖ –í SQL |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç | ‚ùå –í—ã—Å–æ–∫–∞—è | ‚úÖ –ù–∏–∑–∫–∞—è |

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –û—Ç–∫—Ä–æ–π—Ç–µ Chrome DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è
4. –ù–∞–π–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:

**–†–∞–Ω–µ–µ:**
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 1000
üí∞ –î–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º:
  - –ö–∞–º–ø–∞–Ω–∏—è: {days: 1, ...}  ‚ùå –¢–æ–ª—å–∫–æ 1 –¥–µ–Ω—å
```

**–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–∞–º–ø–∞–Ω–∏–π: 53
‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–º–ø–∞–Ω–∏–π: 53
üí∞ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º: [...] ‚úÖ –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

## ‚ùì FAQ

### Q: –ù—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ?
**A:** –ù–µ—Ç, –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –û–Ω–∏ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è—é—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∞—Å—å?
**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Supabase SQL Editor. –í–æ–∑–º–æ–∂–Ω–æ, —Ñ—É–Ω–∫—Ü–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CREATE OR REPLACE FUNCTION`.

### Q: –ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è?
**A:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:
```sql
DROP FUNCTION IF EXISTS public.get_campaign_performance_aggregated(UUID, DATE, DATE);
DROP FUNCTION IF EXISTS public.get_product_performance_by_campaign(UUID, TEXT, DATE, DATE);
```

### Q: –í–ª–∏—è–µ—Ç –ª–∏ —ç—Ç–æ –Ω–∞ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?
**A:** –ù–µ—Ç, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è (`/app/analytics/promotion`).

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### SQL-—Ñ—É–Ω–∫—Ü–∏—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

```sql
-- –®–ê–ì 1: –ù–∞—Ö–æ–¥–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ (campaign_id, stat_date)
WITH campaign_daily_expenses AS (
  SELECT
    campaign_id,
    stat_date,
    MAX(money_spent) as daily_money_spent
  FROM ozon_performance_summary
  WHERE marketplace_id = p_marketplace_id
    AND stat_date BETWEEN p_start_date AND p_end_date
  GROUP BY campaign_id, stat_date
)

-- –®–ê–ì 2: –°—É–º–º–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–Ω–µ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
SELECT
  campaign_id,
  SUM(daily_money_spent) as total_spent,
  COUNT(DISTINCT stat_date) as days_count
FROM campaign_daily_expenses
GROUP BY campaign_id;
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å **–ª—é–±—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö**, –∞ —Ä–∞—Å—Ö–æ–¥—ã –±—É–¥—É—Ç **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã**.

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2026-01-16
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
