# üöÄ –ö–†–ò–¢–ò–ß–ù–û: –î–µ–ø–ª–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## ‚ö†Ô∏è –í–ê–ñ–ù–û

–ú–∏–≥—Ä–∞—Ü–∏—è **—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–ª–∞ cron jobs**, –Ω–æ –ù–ï –æ–±–Ω–æ–≤–∏–ª–∞ —Å–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏!

–ù—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–µ–π:
- `sync-ozon` - –≤–µ—Ä—Å–∏—è 2026-01-16-v2
- `auto-generate-drafts` - –≤–µ—Ä—Å–∏—è 2026-01-16-v1

---

## üìã –®–ê–ì 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Supabase CLI (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

### Windows:
```powershell
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase
```

### macOS:
```bash
brew install supabase/tap/supabase
```

### Linux:
```bash
brew install supabase/tap/supabase
```

---

## üìã –®–ê–ì 2: –í–æ–π–¥–∏—Ç–µ –≤ Supabase

```bash
supabase login
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## üìã –®–ê–ì 3: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–µ–∫—Ç—É

```bash
supabase link --project-ref bkmicyguzlwampuindff
```

–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç –ë–î –µ—Å–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç.

---

## üìã –®–ê–ì 4: –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –î–µ–ø–ª–æ–π –æ–±–µ–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å—Ä–∞–∑—É

```bash
cd /home/user/standalone-spark

supabase functions deploy sync-ozon
supabase functions deploy auto-generate-drafts
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –î–µ–ø–ª–æ–π —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏

```bash
# –î–µ–ø–ª–æ–π sync-ozon
cd supabase/functions/sync-ozon
cat index.ts | head -20  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ VERSION: 2026-01-16-v2
cd ../../..
supabase functions deploy sync-ozon

# –î–µ–ø–ª–æ–π auto-generate-drafts
cd supabase/functions/auto-generate-drafts
cat index.ts | head -20  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ VERSION: 2026-01-16-v1
cd ../../..
supabase functions deploy auto-generate-drafts
```

---

## ‚úÖ –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/project/bkmicyguzlwampuindff/logs/edge-functions

2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `sync-ozon`

3. –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏:
   ```
   [sync-ozon] Found N reviews with published replies
   [sync-ozon] Found M questions with published replies
   ```

4. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `auto-generate-drafts`

5. –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏:
   ```
   [auto-generate-drafts] Skip review XXX: reply exists (status: published)
   ```

---

## üîç –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron jobs:

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Ñ–∞–π–ª–∞ `–ü–†–û–í–ï–†–ö–ê_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql` –≤ Supabase SQL Editor.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:

–ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 –º–∏–Ω—É—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `last_sync_at` –≤ —Ç–∞–±–ª–∏—Ü–µ `marketplaces` –æ–±–Ω–æ–≤–∏–ª—Å—è
- –ù–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `reviews`
- –°–æ–∑–¥–∞—é—Ç—Å—è `replies` –¥–ª—è –Ω–æ–≤—ã—Ö –æ—Ç–∑—ã–≤–æ–≤

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π:

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–ø—Ä–æ—Å 8 –∏–∑ `–ü–†–û–í–ï–†–ö–ê_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql`:

```sql
SELECT
  r.id as review_id,
  r.external_id,
  COUNT(rep.id) as replies_count
FROM reviews r
LEFT JOIN replies rep ON rep.review_id = r.id AND rep.deleted_at IS NULL
WHERE r.deleted_at IS NULL
GROUP BY r.id, r.external_id
HAVING COUNT(rep.id) > 1;
```

**–ù–ï –î–û–õ–ñ–ù–û** –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!

---

## ‚ö° –ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "command not found: supabase"

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Supabase CLI (—Å–º. –®–∞–≥ 1).

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to deploy function"

```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å —Ñ–ª–∞–≥–æ–º --no-verify-jwt
supabase functions deploy sync-ozon --no-verify-jwt
supabase functions deploy auto-generate-drafts --no-verify-jwt
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Project not linked"

```bash
supabase link --project-ref bkmicyguzlwampuindff
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
‚úÖ –ù–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç
‚úÖ –û—Ç–≤–µ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
‚úÖ –ù–ï–¢ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π
‚úÖ `is_answered` –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

---

## üÜò –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```sql
-- 1. Cron jobs
SELECT jobname, schedule, active
FROM cron.job
WHERE jobname LIKE '%ozon%';

-- 2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
SELECT jobname, return_message, start_time
FROM cron.job_run_details
WHERE jobname LIKE '%ozon%'
  AND status != 'succeeded'
ORDER BY start_time DESC
LIMIT 5;

-- 3. –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
SELECT name, last_sync_at, NOW() - last_sync_at as time_ago
FROM marketplaces
WHERE type = 'ozon';
```
