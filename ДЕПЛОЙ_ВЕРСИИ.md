# üöÄ –î–ï–ü–õ–û–ô –§–£–ù–ö–¶–ò–ô - –§–ò–ù–ê–õ–¨–ù–´–ï –í–ï–†–°–ò–ò

**–î–∞—Ç–∞:** 2026-01-16
**–°–µ—Å—Å–∏—è:** Fix duplicate reply publishing + Add 14-day sync button

---

## üì¶ –í–ï–†–°–ò–ò –§–£–ù–ö–¶–ò–ô –î–õ–Ø –î–ï–ü–õ–û–Ø

### 1. sync-ozon
**–í–µ—Ä—Å–∏—è:** `2026-01-16-v2`
**–§–∞–π–ª:** `supabase/functions/sync-ozon/index.ts`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `is_answered` –≤ `false` –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤/–≤–æ–ø—Ä–æ—Å–æ–≤ —Å published replies
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `days_back` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏ –æ—Ç–≤–µ—Ç–æ–≤!

---

### 2. auto-generate-drafts
**–í–µ—Ä—Å–∏—è:** `2026-01-16-v1`
**–§–∞–π–ª:** `supabase/functions/auto-generate-drafts/index.ts`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ replies (published/publishing/scheduled) –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –¥–∞–∂–µ –µ—Å–ª–∏ segment –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ (—Ä–∞–Ω—å—à–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ)

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!

---

## üéØ –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í UI

### Reviews.tsx
**–í–µ—Ä—Å–∏—è:** `2026-01-16-v3`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞ 14 –¥–Ω–µ–π" - –ø–æ–ª–Ω–∞—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –æ–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `performSync(daysBack, description)`
- ‚úÖ –î–≤–µ –∫–Ω–æ–ø–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
  - "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å" - –∑–∞ 7 –¥–Ω–µ–π (–±—ã—Å—Ç—Ä–∞—è)
  - "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞ 14 –¥–Ω–µ–π" - –ø–æ–ª–Ω–∞—è

---

## üíª –ö–û–ú–ê–ù–î–´ –î–õ–Ø –î–ï–ü–õ–û–Ø

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

**Linux/macOS:**
```bash
cd /home/user/standalone-spark
./scripts/deploy_fixes.sh
```

**Windows:**
```powershell
cd C:\path\to\standalone-spark
.\scripts\deploy_fixes.ps1
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd /home/user/standalone-spark

# 2. –í–æ–π–¥–∏—Ç–µ –≤ Supabase (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–ª–∏)
supabase login

# 3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–µ–∫—Ç—É
supabase link --project-ref bkmicyguzlwampuindff

# 4. –î–µ–ø–ª–æ–π sync-ozon (VERSION: 2026-01-16-v2)
supabase functions deploy sync-ozon --no-verify-jwt

# 5. –î–µ–ø–ª–æ–π auto-generate-drafts (VERSION: 2026-01-16-v1)
supabase functions deploy auto-generate-drafts --no-verify-jwt
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –î–ï–ü–õ–û–Ø

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –≤ –ª–æ–≥–∞—Ö

–û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/project/bkmicyguzlwampuindff/logs/edge-functions

**sync-ozon** –¥–æ–ª–∂–µ–Ω –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:
```
[sync-ozon] Found N reviews with published replies
[sync-ozon] Found M questions with published replies
```

**auto-generate-drafts** –¥–æ–ª–∂–µ–Ω –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:
```
[auto-generate-drafts] Skip review XXX: reply exists (status: published)
```

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT
  name,
  last_sync_at,
  NOW() - last_sync_at as "–≤—Ä–µ–º—è_—Å_–ø–æ—Å–ª–µ–¥–Ω–µ–π_—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏"
FROM marketplaces
WHERE type = 'ozon';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `last_sync_at` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- "–≤—Ä–µ–º—è_—Å_–ø–æ—Å–ª–µ–¥–Ω–µ–π_—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏" < 15 –º–∏–Ω—É—Ç

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—É–±–ª–µ–π

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT
  r.id as review_id,
  r.external_id,
  COUNT(rep.id) as replies_count,
  STRING_AGG(rep.status, ', ') as statuses
FROM reviews r
LEFT JOIN replies rep ON rep.review_id = r.id AND rep.deleted_at IS NULL
WHERE r.deleted_at IS NULL
GROUP BY r.id, r.external_id
HAVING COUNT(rep.id) > 1
ORDER BY replies_count DESC;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚ùå **–ü–£–°–¢–û** - –¥—É–±–ª–µ–π –ù–ï–¢!

---

### 4. –¢–µ—Å—Ç –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://your-app.com/app/reviews
2. –ù–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞ 14 –¥–Ω–µ–π"
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë
4. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   - Toast: "–ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏..."
   - Toast: "–ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –∏ –≤–æ–ø—Ä–æ—Å—ã –∑–∞ 14 –¥–Ω–µ–π..."
   - Toast: "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –ø–æ—è–≤–∏–ª–∏—Å—å

---

## üî• –ö–†–ò–¢–ò–ß–ù–û: –ß–¢–û –î–ê–Å–¢ –î–ï–ü–õ–û–ô

### –î–û –¥–µ–ø–ª–æ—è (–ü–†–û–ë–õ–ï–ú–ê):
‚ùå –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –æ—Ç–≤–µ—Ç–∞
‚ùå `is_answered` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
‚ùå –ù–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
‚ùå –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (7 –¥–Ω–µ–π)

### –ü–û–°–õ–ï –¥–µ–ø–ª–æ—è (–†–ï–®–ï–ù–ò–ï):
‚úÖ –ù–ï–¢ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π
‚úÖ `is_answered` –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ replies –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
‚úÖ –î–≤–µ –∫–Ω–æ–ø–∫–∏: –±—ã—Å—Ç—Ä–∞—è (7 –¥–Ω–µ–π) –∏ –ø–æ–ª–Ω–∞—è (14 –¥–Ω–µ–π)

---

## üìä –†–ê–°–ü–ò–°–ê–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ `20260116_setup_new_ozon_sync_logic.sql`:

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- **–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç:** –æ—Ç–∑—ã–≤—ã, –≤–æ–ø—Ä–æ—Å—ã, —á–∞—Ç—ã –∑–∞ 2 –¥–Ω—è
- **–ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 03:00:** –æ—Ç–∑—ã–≤—ã, –≤–æ–ø—Ä–æ—Å—ã, —á–∞—Ç—ã –∑–∞ 14 –¥–Ω–µ–π

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- **–ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å":** –∑–∞ 7 –¥–Ω–µ–π
- **–ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞ 14 –¥–Ω–µ–π":** –∑–∞ 14 –¥–Ω–µ–π

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù!**

–ë–µ–∑ –¥–µ–ø–ª–æ—è:
- ‚ùå –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–ª–∞ cron jobs, –Ω–æ –æ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—Ç –°–¢–ê–†–´–ï –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π
- ‚ùå –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è

**–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
- ‚úÖ –ù–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–µ–π
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –î—É–±–ª–µ–π –ù–ï–¢

---

## üÜò –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –ü—Ä–æ–±–ª–µ–º–∞: "command not found: supabase"
**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Supabase CLI

**macOS:**
```bash
brew install supabase/tap/supabase
```

**Windows:**
```powershell
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to deploy function"
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å —Ñ–ª–∞–≥–æ–º `--no-verify-jwt`

```bash
supabase functions deploy sync-ozon --no-verify-jwt
supabase functions deploy auto-generate-drafts --no-verify-jwt
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è
**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –≤ –ª–æ–≥–∞—Ö
# sync-ozon –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 2026-01-16-v2
# auto-generate-drafts –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 2026-01-16-v1
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –ü–†–û–í–ï–†–ö–ê_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql –≤ SQL Editor
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
```

---

## üìù –§–ê–ô–õ–´ –í –ö–û–ú–ú–ò–¢–ï

- ‚úÖ `supabase/functions/sync-ozon/index.ts` - VERSION: 2026-01-16-v2
- ‚úÖ `supabase/functions/auto-generate-drafts/index.ts` - VERSION: 2026-01-16-v1
- ‚úÖ `src/pages/Reviews.tsx` - VERSION: 2026-01-16-v3
- ‚úÖ `–î–ï–ü–õ–û–ô_–í–ï–†–°–ò–ò.md` - —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

---

## ‚ú® –ò–¢–û–ì–û

–ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –≤—ã—à–µ, –∏ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (2 –¥–Ω—è)
2. –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é (14 –¥–Ω–µ–π)
3. –î–≤–µ –∫–Ω–æ–ø–∫–∏ —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (7 –∏ 14 –¥–Ω–µ–π)
4. –ù–ï–¢ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π
5. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

**–í—Ä–µ–º—è –¥–µ–ø–ª–æ—è:** ~2-3 –º–∏–Ω—É—Ç—ã
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø (–±–µ–∑ –¥–µ–ø–ª–æ—è –¥—É–±–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—Å—è!)
