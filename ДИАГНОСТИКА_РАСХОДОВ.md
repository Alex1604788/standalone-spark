# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º –≤–∏–¥–Ω–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É –¥–∞–Ω–Ω—ã–º–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –≤ OZON Seller:

| –ü–µ—Ä–∏–æ–¥ | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | OZON Seller | –°–æ–≤–ø–∞–¥–∞–µ—Ç? |
|--------|------------|-------------|------------|
| 1-7 –¥–µ–∫–∞–±—Ä—è | 24 428 ‚ÇΩ | 24 428,11 ‚ÇΩ | ‚úÖ –î–ê |
| 1-31 –¥–µ–∫–∞–±—Ä—è | **20 840 ‚ÇΩ** | **109 129,99 ‚ÇΩ** | ‚ùå –ù–ï–¢ |

**–°—Ç—Ä–∞–Ω–Ω–æ—Å—Ç—å:** –ó–∞ –±–æ–ª—å—à–∏–π –ø–µ—Ä–∏–æ–¥ (–º–µ—Å—è—Ü) —Ä–∞—Å—Ö–æ–¥—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ **–º–µ–Ω—å—à–µ**, —á–µ–º –∑–∞ –Ω–µ–¥–µ–ª—é! –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Å –¥–∞–Ω–Ω—ã–º–∏.

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **–ù–µ –≤—Å–µ –¥–Ω–∏ –¥–µ–∫–∞–±—Ä—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –±–∞–∑—É**
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è OZON –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–Ω–∏
   - –î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π**
   - –ö–æ–¥ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –ø–æ (campaign_id, stat_date)
   - –í–æ–∑–º–æ–∂–Ω–æ, –∫–∞–∫–∏–µ-—Ç–æ –∑–∞–ø–∏—Å–∏ –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ campaign_id

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π**
   - –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor

https://supabase.com/dashboard/project/bkmicyguzlwampuindff/sql/new

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Ñ–∞–π–ª–∞ `debug-campaign-expenses.sql`

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ 7 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –æ—á–µ—Ä–µ–¥–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### 3. –ö–ª—é—á–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### –ó–ê–ü–†–û–° 4: –ó–∞ –Ω–µ–¥–µ–ª—é (1-7 –¥–µ–∫–∞–±—Ä—è)
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **~24 428 ‚ÇΩ**

#### –ó–ê–ü–†–û–° 5: –ó–∞ –º–µ—Å—è—Ü (1-31 –¥–µ–∫–∞–±—Ä—è)
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **~109 130 ‚ÇΩ**

#### –ó–ê–ü–†–û–° 6: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–∞—Ç
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ **–í–°–ï –¥–Ω–∏ –¥–µ–∫–∞–±—Ä—è** (—Å 1 –ø–æ 31).

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

### –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–Ω–∏ –Ω–µ—Ç:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é OZON** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–Ω–µ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function `ozon-sync-performance` –Ω–∞ –æ—à–∏–±–∫–∏
3. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤

### –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –∑–∞ –≤—Å–µ –¥–Ω–∏, –Ω–æ —Å—É–º–º–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `campaign_id`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∑–∞–ø–∏—Å–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ `stat_date`
3. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ª–æ–≥–∏–∫–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ

---

## –ö–æ–¥ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

–í —Ñ–∞–π–ª–µ `src/pages/analytics/PromotionAnalytics.tsx` (—Å—Ç—Ä–æ–∫–∏ 268-410) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:

```typescript
// –®–ê–ì 1: –ù–∞—Ö–æ–¥–∏–º –£–ù–ò–ö–ê–õ–¨–ù–´–ï —Ä–∞—Å—Ö–æ–¥—ã –ø–æ (campaign_id, stat_date)
const campaignDailyExpenses = new Map<string, Map<string, number>>();

performanceData.forEach((row: any) => {
  const campaignId = (!row.campaign_id || row.campaign_id === "")
    ? "__NO_CAMPAIGN__"
    : String(row.campaign_id);
  const date = row.stat_date;

  if (!campaignDailyExpenses.has(campaignId)) {
    campaignDailyExpenses.set(campaignId, new Map());
  }

  const dailyMap = campaignDailyExpenses.get(campaignId)!;
  dailyMap.set(date, Math.max(dailyMap.get(date) || 0, Number(row.money_spent || 0)));
});

// –®–ê–ì 3: –°—É–º–º–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–Ω–µ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
campaignDailyExpenses.forEach((dailyMap, campaignId) => {
  const campaign = campaignMap.get(campaignId);
  if (campaign) {
    const uniqueDailyExpenses = Array.from(dailyMap.values());
    campaign.total_money_spent = uniqueDailyExpenses.reduce((sum, val) => sum + val, 0);
  }
});
```

–≠—Ç–∞ –ª–æ–≥–∏–∫–∞ **–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è** –∏ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –ø–æ–ª–Ω—ã–µ.

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã
2. üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. üîß –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ - –ª–∏–±–æ –¥–æ–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –ª–∏–±–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É

–ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤, –∏ —è –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏–µ!
