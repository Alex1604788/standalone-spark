# üö® –°–†–û–ß–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∂–∏–º–µ READ-ONLY

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—à–ª–∞ –≤ —Ä–µ–∂–∏–º read-only –∏–∑-–∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. –ù–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## üìä –ì–õ–ê–í–ù–´–ô –í–û–ü–†–û–°: –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ò–ò

### ‚úÖ –û—Ç–≤–µ—Ç: `product_knowledge`

–≠—Ç–æ **–ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø** —Ç–∞–±–ª–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –æ —Ç–æ–≤–∞—Ä–∞—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ò–ò.

**–í–∞–∂–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- **–¢–∞–±–ª–∏—Ü–∞:** `public.product_knowledge`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ —Ç–æ–≤–∞—Ä–∞—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ò–ò-–æ—Ç–≤–µ—Ç–æ–≤
- **–†–∞–∑–º–µ—Ä:** –û–±—ã—á–Ω–æ –Ω–µ–±–æ–ª—å—à–æ–π (–¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é)
- **–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:** –û–¢–ö–õ–Æ–ß–ï–ù–û (—Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥)
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø - —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ù–ï–õ–¨–ó–Ø —Ç–µ—Ä—è—Ç—å

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
CREATE TABLE public.product_knowledge (
  id UUID PRIMARY KEY,
  product_id UUID NOT NULL,
  marketplace_id UUID NOT NULL,

  -- –ö–æ–Ω—Ç–µ–Ω—Ç
  title TEXT NOT NULL,
  content TEXT NOT NULL,

  -- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
  source_type TEXT NOT NULL,  -- 'supplier', 'manager', 'faq', 'instruction', 'specification'

  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  tags TEXT[],
  relevance_score DECIMAL(3,2),

  -- –ò—Å—Ç–æ—á–Ω–∏–∫–∏
  created_by UUID,
  source_review_id UUID,
  source_question_id UUID,
  source_reply_id UUID,

  -- Timestamps
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

---

## üîç –¢–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –ó–ê–ë–ò–í–ê–Æ–¢ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### ‚ùå –ù–ï —è–≤–ª—è—é—Ç—Å—è –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –¥–ª—è –ò–ò (—ç—Ç–æ –ª–æ–≥–∏):

1. **`audit_log`** - –ª–æ–≥–∏ –∞—É–¥–∏—Ç–∞ —Å–∏—Å—Ç–µ–º—ã
   - –£–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
   - –ú–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 2-4 GB

2. **`ozon_sync`** - –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Ozon API
   - –£–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
   - –ú–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 1-2 GB

3. **`ozon_sync_history`** - –∏—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
   - –£–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π

4. **`logs_ai`** - –ª–æ–≥–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ AI
   - –£–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π

5. **`ai_reply_history`** - –∏—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ AI
   - –£–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π

6. **`import_logs`** - –ª–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
   - –£–¥–∞–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π

---

## üíæ –ö–ê–ö –°–û–•–†–ê–ù–ò–¢–¨ –î–ê–ù–ù–´–ï: product_knowledge

### –í–∞—Ä–∏–∞–Ω—Ç 1: –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase SQL Editor:

```sql
-- –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ product_knowledge –≤ JSON
COPY (
  SELECT
    json_agg(
      json_build_object(
        'id', id,
        'product_id', product_id,
        'marketplace_id', marketplace_id,
        'title', title,
        'content', content,
        'source_type', source_type,
        'tags', tags,
        'relevance_score', relevance_score,
        'created_by', created_by,
        'source_review_id', source_review_id,
        'source_question_id', source_question_id,
        'source_reply_id', source_reply_id,
        'created_at', created_at,
        'updated_at', updated_at
      )
    )
  FROM public.product_knowledge
) TO '/tmp/product_knowledge_backup.json';
```

**–ó–∞—Ç–µ–º —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª —á–µ—Ä–µ–∑ Supabase Dashboard.**

### –í–∞—Ä–∏–∞–Ω—Ç 2: –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV

```sql
COPY (
  SELECT
    id,
    product_id,
    marketplace_id,
    title,
    content,
    source_type,
    array_to_string(tags, ',') as tags,
    relevance_score,
    created_by,
    source_review_id,
    source_question_id,
    source_reply_id,
    created_at,
    updated_at
  FROM public.product_knowledge
  ORDER BY created_at DESC
) TO '/tmp/product_knowledge_backup.csv' WITH (FORMAT CSV, HEADER);
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ —á–µ—Ä–µ–∑ pg_dump

```bash
# –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
pg_dump -h <host> -U <user> -t public.product_knowledge -d <database> > product_knowledge_backup.sql
```

---

## üöÄ –≠–ö–°–¢–†–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –í–µ—Ä–Ω—É—Ç—å –±–∞–∑—É –≤ —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
psql -c "SELECT pg_size_pretty(pg_database_size(current_database()));"
```

### –®–ê–ì 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –æ—á–∏—Å—Ç–∫—É

–ï—Å—Ç—å 2 —Å–∫—Ä–∏–ø—Ç–∞ –æ—á–∏—Å—Ç–∫–∏:

#### A. –°—Ä–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ `audit_log` (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
```sql
-- –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª: AUTO_CLEANUP_URGENT.sql
-- –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç cron job –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —É–¥–∞–ª—è—Ç—å –ø–æ 15,000-20,000 –∑–∞–ø–∏—Å–µ–π –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
-- –ë–∞–∑–∞ –æ—á–∏—Å—Ç–∏—Ç—Å—è –∑–∞ 3-5 —á–∞—Å–æ–≤
```

#### B. –û—á–∏—Å—Ç–∫–∞ `ozon_sync` –ª–æ–≥–æ–≤
```sql
-- –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª: CLEANUP_OZON_SYNC_LOGS.sql
-- –£–¥–∞–ª–∏—Ç –≤—Å–µ –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
-- –û—Å–≤–æ–±–æ–¥–∏—Ç 1-2 GB
```

### –®–ê–ì 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –Ω–∞ –±—É–¥—É—â–µ–µ

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –±–∞–∑–∞ –≤–µ—Ä–Ω–µ—Ç—Å—è –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

```sql
-- 1. –í–∫–ª—é—á–∏—Ç—å –µ–∂–µ—á–∞—Å–Ω—É—é –æ—á–∏—Å—Ç–∫—É audit_log
-- –ó–∞–ø—É—Å—Ç–∏—Ç–µ: supabase/migrations/20260119_auto_cleanup_audit_log.sql

-- 2. –í–∫–ª—é—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É ozon_sync
-- –ó–∞–ø—É—Å—Ç–∏—Ç–µ: supabase/migrations/20260119_cleanup_ozon_sync_logs.sql
```

---

## üìã –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### 1Ô∏è‚É£ –°–ï–ô–ß–ê–° (–ø–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç)
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ product_knowledge (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç 1 –≤—ã—à–µ)
```

### 2Ô∏è‚É£ –°–†–û–ß–ù–û (—Å–ª–µ–¥—É—é—â–∏–µ 10 –º–∏–Ω—É—Ç)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Supabase SQL Editor:
# 1. –§–∞–π–ª: CLEANUP_OZON_SYNC_LOGS.sql
# 2. –§–∞–π–ª: AUTO_CLEANUP_URGENT.sql
```

### 3Ô∏è‚É£ –ü–û–î–û–ñ–î–ò–¢–ï (3-5 —á–∞—Å–æ–≤)
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏:
SELECT * FROM cron.job_run_details
ORDER BY start_time DESC
LIMIT 10;

# –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç:
SELECT pg_size_pretty(pg_database_size(current_database()));
```

### 4Ô∏è‚É£ –ö–û–ì–î–ê –ë–ê–ó–ê –û–ß–ò–°–¢–ò–¢–°–Ø
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ä–æ—á–Ω—É—é –æ—á–∏—Å—Ç–∫—É:
SELECT cron.unschedule('cleanup-audit-log-urgent');

# 2. –í–∫–ª—é—á–∏—Ç–µ –æ–±—ã—á–Ω—É—é –µ–∂–µ—á–∞—Å–Ω—É—é –æ—á–∏—Å—Ç–∫—É:
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ: supabase/migrations/20260119_auto_cleanup_audit_log.sql

# 3. –í–∫–ª—é—á–∏—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É ozon_sync:
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ: supabase/migrations/20260119_cleanup_ozon_sync_logs.sql
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø

### ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û –£–î–ê–õ–Ø–¢–¨:
- `audit_log` —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- `ozon_sync` —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- `ozon_sync_history` —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
- `logs_ai` —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
- `ai_reply_history` —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
- `import_logs` —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π

### ‚ùå –ù–ò–ö–û–ì–î–ê –ù–ï –£–î–ê–õ–Ø–ô–¢–ï:
- `product_knowledge` - –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –ò–ò
- `products` - —Ç–æ–≤–∞—Ä—ã
- `reviews` - –æ—Ç–∑—ã–≤—ã
- `replies` - –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã
- `marketplaces` - –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã
- `profiles` - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `suppliers` - –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏
- `product_business_data` - –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤

---

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Supabase
2. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ
3. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–º–æ—â—å –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ read-only —Ä–µ–∂–∏–º–∞

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ—á–∏—Å—Ç–∫–µ: `AUTO_CLEANUP_URGENT.sql`
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ë–î: `DATABASE_SIZE_DIAGNOSTIC.sql`
- –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞: `SIMPLE_SIZE_CHECK.sql`
