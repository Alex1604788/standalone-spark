# üéØ –ò–¢–û–ì–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò OZON PERFORMANCE

## üî¥ –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

### –û—à–∏–±–∫–∞: "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–º–∞–∫—Å–∏–º—É–º 1)"

**–ü—Ä–∏—á–∏–Ω–∞:**
- OZON API —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ **1 –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- Polling –æ—Ç—á–µ—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç **~75 —Å–µ–∫—É–Ω–¥**
- –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∫–∞–º–ø–∞–Ω–∏—è–º–∏ –±—ã–ª–∞ **–≤—Å–µ–≥–æ 3 —Å–µ–∫—É–Ω–¥—ã**
- –°–ª–µ–¥—É—é—â–∞—è –∫–∞–º–ø–∞–Ω–∏—è –Ω–∞—á–∏–Ω–∞–ª–∞ –∑–∞–ø—Ä–æ—Å **–ø–æ–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –µ—â–µ –≤ polling**
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –æ—à–∏–±–∫–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞ "chunk 2"

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–∞–¥–∞–ª–∞ –ø–æ—Å–ª–µ 1-2 –∫–∞–º–ø–∞–Ω–∏–π
- ‚ùå –ó–∞–≤–∏—Å—à–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (in_progress >30 –º–∏–Ω—É—Ç)
- ‚ùå –ò–∑ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π: 5 —Å –æ—à–∏–±–∫–∞–º–∏, 1 –∑–∞–≤–∏—Å–ª–∞
- ‚ùå –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ 3-8 –∫–∞–º–ø–∞–Ω–∏–π –∏–∑ 55

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï:

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (v3.0.8-fix-ozon-api-limit):

**–§–∞–π–ª:** `supabase/functions/sync-ozon-performance/index.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```typescript
// –ë–´–õ–û:
await new Promise(resolve => setTimeout(resolve, 3000));  // 3 —Å–µ–∫—É–Ω–¥—ã

// –°–¢–ê–õ–û:
await new Promise(resolve => setTimeout(resolve, 90000));  // 90 —Å–µ–∫—É–Ω–¥
```

**–ü–æ—á–µ–º—É 90 —Å–µ–∫—É–Ω–¥:**
- Polling –æ—Ç—á–µ—Ç–∞: 75 —Å–µ–∫—É–Ω–¥ (15 –ø–æ–ø—ã—Ç–æ–∫ √ó 5 —Å–µ–∫)
- –ó–∞–ø–∞—Å –≤—Ä–µ–º–µ–Ω–∏: 15 —Å–µ–∫—É–Ω–¥
- –ò—Ç–æ–≥–æ: **90 —Å–µ–∫—É–Ω–¥** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

---

## üìã –ß–¢–û –°–î–ï–õ–ê–ù–û:

1. ‚úÖ **–ù–∞–π–¥–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞** - –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∏ –∫–æ–¥–∞
2. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–¥** - —É–≤–µ–ª–∏—á–µ–Ω–∞ –ø–∞—É–∑–∞ —Å 3 –¥–æ 90 —Å–µ–∫
3. ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è** - 3.0.7 ‚Üí 3.0.8-fix-ozon-api-limit
4. ‚úÖ **–ó–∞–∫–æ–º–º–∏—á–µ–Ω–æ** - –∫–æ–º–º–∏—Ç `03b5ed8`
5. ‚úÖ **–ó–∞–ø—É—à–µ–Ω–æ** - –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions
6. ‚úÖ **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç** - `–¢–ï–°–¢_–ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql`

---

## üöÄ –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:

### –®–∞–≥ 1: –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è (2-3 –º–∏–Ω—É—Ç—ã)

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é Edge Function.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
- https://github.com/Alex1604788/standalone-spark/actions

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor:
   https://supabase.com/dashboard/project/bkmicyguzlwampuindff/sql

2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `–¢–ï–°–¢_–ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql`

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor

4. –ù–∞–∂–º–∏—Ç–µ **RUN**

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
- ‚úÖ –ó–∞–≤–µ—Ä—à–∞—Ç—Å—è –∑–∞–≤–∏—Å—à–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (7 –¥–Ω–µ–π)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ 10-15 –º–∏–Ω—É—Ç

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SELECT
  status,
  started_at,
  completed_at,
  campaigns_count,
  rows_inserted,
  error_message
FROM ozon_sync_history
WHERE marketplace_id = '84b1d0f5-6750-407c-9b04-28c051972162'
ORDER BY started_at DESC
LIMIT 1;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ `status = 'completed'`
- ‚úÖ `error_message IS NULL` –∏–ª–∏ `''`
- ‚úÖ `rows_inserted > 0`

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å:**
- ‚ö†Ô∏è –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –µ—â–µ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â–µ 2-3 –º–∏–Ω—É—Ç—ã

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∑–∞ 62 –¥–Ω—è

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:**

```sql
SELECT public.trigger_ozon_performance_sync(
  '84b1d0f5-6750-407c-9b04-28c051972162'::uuid,
  'full'
);
```

**–≠—Ç–æ –∑–∞–π–º–µ—Ç 30-40 –º–∏–Ω—É—Ç:**
- 55 –∫–∞–º–ø–∞–Ω–∏–π √ó 90 —Å–µ–∫—É–Ω–¥ = ~80 –º–∏–Ω—É—Ç
- –ù–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ 4 –∫–∞–º–ø–∞–Ω–∏–∏ –∑–∞ —Ä–∞–∑ (2 chunks √ó 2)
- Auto-continue chain –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏ —á–∞—Å—Ç—è–º–∏

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ**
- –í—Å–µ 55 –∫–∞–º–ø–∞–Ω–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- –ù–µ—Ç –æ—à–∏–±–æ–∫ "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç"
- –ù–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

‚úÖ **–î–∞–Ω–Ω—ã–µ –∑–∞ 62 –¥–Ω—è**
- –ú–∏–Ω–∏–º—É–º 62 –¥–Ω—è –∏—Å—Ç–æ—Ä–∏–∏
- orders + orders_model —Å—É–º–º–∏—Ä—É—é—Ç—Å—è
- revenue + revenue_model —Å—É–º–º–∏—Ä—É—é—Ç—Å—è

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
- CRON job –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC
- CRON job –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (–ø–æ–ª–Ω–∞—è –∑–∞ 62 –¥–Ω—è)

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:

1. ‚úÖ `supabase/functions/sync-ozon-performance/index.ts` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω)
   - –£–≤–µ–ª–∏—á–µ–Ω–∞ –ø–∞—É–∑–∞ –¥–æ 90 —Å–µ–∫—É–Ω–¥
   - –í–µ—Ä—Å–∏—è 3.0.8-fix-ozon-api-limit

2. ‚úÖ `–¢–ï–°–¢_–ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql`
   - –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–≤–∏—Å—à–∏–µ
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ

3. ‚úÖ `CREATE_VIEW_AUTO_SUM.sql`
   - VIEW –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
   - orders + orders_model
   - revenue + revenue_model

4. ‚úÖ `–ó–ê–ü–£–°–ö_–ù–ê–°–¢–†–û–ô–ö–ò_OZON_SYNC.sql`
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CRON jobs
   - Service role key
   - API credentials

5. ‚úÖ `–ü–†–û–í–ï–†–ö–ê_–ò_–ó–ê–ü–£–°–ö_–ü–û–õ–ù–û–ô_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–∏–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
   - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö
   - –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üéâ –ò–¢–û–ì:

### –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
- ‚ùå 50% —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π –ø–∞–¥–∞–ª–∏ —Å –æ—à–∏–±–∫–æ–π
- ‚ùå –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ—Å—å 3-8 –∫–∞–º–ø–∞–Ω–∏–π –∏–∑ 55
- ‚ùå –û—à–∏–±–∫–∞ "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤"

### –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –í—Å–µ 55 –∫–∞–º–ø–∞–Ω–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ OZON API limit
- ‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞ 62 –¥–Ω—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

## üìû –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1. ‚è≥ –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è (2-3 –º–∏–Ω)
2. üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç (`–¢–ï–°–¢_–ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô_–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò.sql`)
3. ‚è±Ô∏è –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-15 –º–∏–Ω—É—Ç
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
5. üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∑–∞ 62 –¥–Ω—è

**–ì–æ—Ç–æ–≤–æ!** üéâ
