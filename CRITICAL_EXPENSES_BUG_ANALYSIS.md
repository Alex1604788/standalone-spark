# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó: –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –Ω–µ —Ä–µ—à–µ–Ω–∞

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–∑–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∏–∑ OZON Seller):**
- –ó–∞ –Ω–µ–¥–µ–ª—é (1-7 –¥–µ–∫): ~24 428 ‚ÇΩ
- –ó–∞ –º–µ—Å—è—Ü (1-31 –¥–µ–∫): ~109 130 ‚ÇΩ

**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** –†–∞—Å—Ö–æ–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
OZON API
   ‚Üì
ozon_performance_daily (—Ç–∞–±–ª–∏—Ü–∞ –ë–î)
   ‚Üì
ozon_performance_summary (VIEW)  ‚Üê –ù–ï –¥–µ–ª–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é money_spent!
   ‚Üì
PromotionAnalytics.tsx (–∫–æ–¥ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)
   ‚Üì
UI
```

---

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

### 1. VIEW –Ω–µ –¥–µ–ª–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é

**–§–∞–π–ª:** `supabase/migrations/20260112000000_create_ozon_performance_summary_view.sql`

```sql
CREATE OR REPLACE VIEW public.ozon_performance_summary AS
SELECT
  ...
  money_spent,  -- ‚ùå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ö–ê–ö –ï–°–¢–¨ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
  ...
FROM public.ozon_performance_daily;
```

**–í—ã–≤–æ–¥:** VIEW —Ç–æ–ª—å–∫–æ —Å—É–º–º–∏—Ä—É–µ—Ç `orders + orders_model` –∏ `revenue + revenue_model`. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é `money_spent` –¥–µ–ª–∞–µ—Ç –¢–û–õ–¨–ö–û –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!

### 2. –ö–æ–¥ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –µ—Å—Ç—å

**–§–∞–π–ª:** `src/pages/analytics/PromotionAnalytics.tsx:268-410`

```typescript
// –®–ê–ì 1: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ (campaign_id, stat_date)
const campaignDailyExpenses = new Map<string, Map<string, number>>();

performanceData.forEach((row: any) => {
  const campaignId = (!row.campaign_id || row.campaign_id === "")
    ? "__NO_CAMPAIGN__"
    : String(row.campaign_id);
  const date = row.stat_date;

  if (!campaignDailyExpenses.has(campaignId)) {
    campaignDailyExpenses.set(campaignId, new Map());
  }

  const dailyMap = campaignDailyExpenses.get(campaignId)!;
  dailyMap.set(date, Math.max(dailyMap.get(date) || 0, Number(row.money_spent || 0)));
});

// –®–ê–ì 3: –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
campaignDailyExpenses.forEach((dailyMap, campaignId) => {
  const campaign = campaignMap.get(campaignId);
  if (campaign) {
    const uniqueDailyExpenses = Array.from(dailyMap.values());
    campaign.total_money_spent = uniqueDailyExpenses.reduce((sum, val) => sum + val, 0);
  }
});
```

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ (7/7 —Ç–µ—Å—Ç–æ–≤ ‚úÖ)

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –ü—Ä–∏—á–∏–Ω–∞ 1: –ö–æ–¥ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
git log --oneline -5
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–º–º–∏—Ç: fc4a847 fix: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤
```

**–ï—Å–ª–∏ –∫–æ–¥ –µ—Å—Ç—å –≤ git, –Ω–æ –Ω–µ –≤ production:**
- –ù—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ production –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ç–∫—É

### ‚ùå –ü—Ä–∏—á–∏–Ω–∞ 2: –î–∞–Ω–Ω—ã–µ –≤ –ë–î –Ω–µ–ø–æ–ª–Ω—ã–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Supabase Dashboard:**

```sql
-- –ó–∞–ø—Ä–æ—Å 1: –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–µ–∫–∞–±—Ä—è –µ—Å—Ç—å –≤ –ë–î?
SELECT COUNT(DISTINCT stat_date) as days_count
FROM ozon_performance_daily
WHERE campaign_name = '–ö–∞–±–µ–ª—å –ö–ì 2*2,5'
  AND stat_date >= '2025-12-01'
  AND stat_date <= '2025-12-31';
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 31
```

```sql
-- –ó–∞–ø—Ä–æ—Å 2: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π
SELECT SUM(daily_expense) as total_correct
FROM (
  SELECT stat_date, MAX(money_spent) as daily_expense
  FROM ozon_performance_daily
  WHERE campaign_name = '–ö–∞–±–µ–ª—å –ö–ì 2*2,5'
    AND stat_date >= '2025-12-01'
    AND stat_date <= '2025-12-31'
  GROUP BY stat_date
) as daily_unique;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: ~109 130
```

**–ï—Å–ª–∏ –¥–Ω–µ–π < 31:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é OZON –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Edge Function `ozon-sync-performance`

### ‚ùå –ü—Ä–∏—á–∏–Ω–∞ 3: –ö–µ—à –±—Ä–∞—É–∑–µ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Hard Refresh (Ctrl+Shift+R –∏–ª–∏ Cmd+Shift+R)
- –û—á–∏—Å—Ç–∏—Ç—å Application Storage –≤ DevTools
- –û—Ç–∫—Ä—ã—Ç—å –≤ Incognito mode

### ‚ùå –ü—Ä–∏—á–∏–Ω–∞ 4: –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
–û—Ç–∫—Ä–æ–π—Ç–µ DevTools Console –∏ –Ω–∞–π–¥–∏—Ç–µ:

```
üí∞ –î–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º:
  - –ö–∞–±–µ–ª—å –ö–ì 2*2,5: {
    days: 31,  // ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 31
    dailyExpenses: [...],
    total: 109130  // ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ~109130
  }
```

**–ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç:**
- –ö–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

### ‚ùå –ü—Ä–∏—á–∏–Ω–∞ 5: VIEW –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –≤ –ë–î

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ VIEW —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
SELECT * FROM information_schema.views
WHERE table_name = 'ozon_performance_summary';
```

**–ï—Å–ª–∏ VIEW –Ω–µ—Ç –∏–ª–∏ —Å—Ç–∞—Ä—ã–π:**
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
-- –§–∞–π–ª: supabase/migrations/20260112000000_create_ozon_performance_summary_view.sql
```

### ‚ùå –ü—Ä–∏—á–∏–Ω–∞ 6: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π marketplace_id

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**
–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
```
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 0
‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ ozon_performance_summary –¥–ª—è marketplace: <ID>
```

**–ï—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π 0:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `marketplace_id` –≤ UI —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–∞–Ω–Ω—ã–º –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º

---

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

### üî• –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!)

1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –û—Ç–∫—Ä—ã—Ç—å DevTools (F12)
3. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console
4. –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å
5. –í—ã–±—Ä–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é "–ö–∞–±–µ–ª—å –ö–ì 2*2,5" –∏ –ø–µ—Ä–∏–æ–¥ –¥–µ–∫–∞–±—Ä—å 2025
6. –ù–∞–π—Ç–∏ –ª–æ–≥ `üí∞ –î–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º:`

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- `days` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å = 31 (–∏–ª–∏ –º–µ–Ω—å—à–µ –µ—Å–ª–∏ –Ω–µ –≤—Å–µ –¥–Ω–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)
- `total` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~109130
- –ï—Å–ª–∏ –Ω–µ—Ç –ª–æ–≥–∞ - –∫–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - —á–∏—Ç–∞—Ç—å –∏—Ö

### üî• –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é

–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Å–µ–∫—Ü–∏–∏ "–ü—Ä–∏—á–∏–Ω–∞ 2" –≤—ã—à–µ.

### üî• –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –≤ CI/CD
git log -1 --oneline
# –î–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –∫–æ–º–º–∏—Ç fc4a847 –∏–ª–∏ –Ω–æ–≤–µ–µ
```

### üî• –®–ê–ì 4: Hard Refresh

Ctrl+Shift+R (Windows/Linux) –∏–ª–∏ Cmd+Shift+R (Mac)

---

## –ß—Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Unit —Ç–µ—Å—Ç—ã:** 7/7 ‚úÖ - –ª–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø
2. **–ö–æ–¥:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ –∏ –∑–∞–ø—É—à–µ–Ω–æ
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–æ–∑–¥–∞–Ω–∞

### ‚ùå –ß—Ç–æ –ù–ï –º–æ–≥—É

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å production –ë–î** - –Ω–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Supabase
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å UI** - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±—Ä–∞—É–∑–µ—Ä—É
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π** - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ production –æ–∫—Ä—É–∂–µ–Ω–∏—é

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (–ë–´–°–¢–†–û)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. F12 ‚Üí Console
3. –ù–∞–π–¥–∏—Ç–µ –ª–æ–≥ `üí∞ –î–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã`
4. –ü–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ —Ç–µ–∫—Å—Ç –ª–æ–≥–∞

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard/project/bkmicyguzlwampuindff/sql/new
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Å–µ–∫—Ü–∏–∏ "–ü—Ä–∏—á–∏–Ω–∞ 2"
3. –ü–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç C: –î–∞–π—Ç–µ –º–Ω–µ –¥–æ—Å—Ç—É–ø

–ï—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞–π—Ç–µ –º–Ω–µ:
- –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- –°–∫—Ä–∏–Ω—à–æ—Ç UI —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —è —Å–º–æ–≥—É:

1. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥–∞–Ω–Ω—ã—Ö –ë–î:** –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
2. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥
3. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥–µ–ø–ª–æ–µ:** –ü–æ–º–æ—á—å –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å
4. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ VIEW:** –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VIEW —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π

---

**–°–æ–∑–¥–∞–Ω–æ:** 2026-01-15
**–°—Ç–∞—Ç—É—Å:** üî¥ –û–ñ–ò–î–ê–ù–ò–ï –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
