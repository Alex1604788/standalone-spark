# üìò –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–•

**–î–∞—Ç–∞:** 2026-01-25
**–¶–µ–ª—å:** –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 100-150 MB (20-25%)

---

## üéØ –®–ê–ì 1: –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –¢–ê–ë–õ–ò–¶–´ REPLICAS (337 MB)

–≠—Ç–æ —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤ –ë–î. –ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —ç—Ç–æ –∏ –º–æ–∂–Ω–æ –ª–∏ –µ—ë –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å.

### –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
# –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
psql -f –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_REPLICAS.sql
```

–ò–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_REPLICAS.sql` –≤ Supabase SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å.

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã** - –µ—Å–ª–∏ `public`, —Ç–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—ë—Ä—Ç–≤—ã—Ö —Å—Ç—Ä–æ–∫** (n_dead_tup) - –µ—Å–ª–∏ –º–Ω–æ–≥–æ, –Ω—É–∂–µ–Ω VACUUM
3. **–¢–∏–ø —Ç–∞–±–ª–∏—Ü—ã** - —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

#### –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º—ë—Ä—Ç–≤—ã—Ö —Å—Ç—Ä–æ–∫ (dead tuples):
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å VACUUM –¥–ª—è —Å–∂–∞—Ç–∏—è
VACUUM (VERBOSE, ANALYZE) replicas;

-- –ò–ª–∏ VACUUM FULL –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É!)
-- VACUUM FULL replicas;
```

#### –ï—Å–ª–∏ —ç—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω—É–∂–Ω—ã –ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
- –£–¥–∞–ª–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏

#### –ï—Å–ª–∏ —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Supabase:
- ‚ö†Ô∏è –ù–ï –¢–†–û–ì–ê–¢–¨ –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å Supabase support
- –û—Ç–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç: https://supabase.com/support

---

## üéØ –®–ê–ì 2: –ü–†–ò–ú–ï–ù–ò–¢–¨ –ú–ò–ì–†–ê–¶–ò–ò –ê–í–¢–û–û–ß–ò–°–¢–ö–ò

–°–æ–∑–¥–∞–Ω—ã 2 –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. `20260125120700_cleanup_audit_log.sql` - –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –∞—É–¥–∏—Ç–∞ (90 –¥–Ω–µ–π)
2. `20260125120800_cleanup_storage_costs.sql` - –æ—á–∏—Å—Ç–∫–∞ storage_costs (6 –º–µ—Å—è—Ü–µ–≤)

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Supabase CLI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
ls -la supabase/migrations/20260125120*.sql

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
supabase db push

# –ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∞–∑–µ
supabase db push --db-url "postgresql://..."
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Supabase Dashboard

1. –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `supabase/migrations/20260125120700_cleanup_audit_log.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `supabase/migrations/20260125120800_cleanup_storage_costs.sql`
5. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
SELECT routine_name, routine_type
FROM information_schema.routines
WHERE routine_schema = 'public'
  AND routine_name IN ('cleanup_audit_log', 'cleanup_storage_costs');

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ CRON –∑–∞–¥–∞—á–∏
SELECT jobname, schedule, active
FROM cron.job
WHERE jobname IN ('cleanup-audit-log-weekly', 'cleanup-storage-costs-monthly');
```

---

## üéØ –®–ê–ì 3: –†–£–ß–ù–û–ô –ó–ê–ü–£–°–ö –û–ß–ò–°–¢–ö–ò (–ü–ï–†–í–´–ô –†–ê–ó)

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏ –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø–µ—Ä–≤–æ–π –æ—á–∏—Å—Ç–∫–∏.

```sql
-- 1. –û—á–∏—Å—Ç–∫–∞ audit_log (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π)
SELECT * FROM public.cleanup_audit_log();

-- 2. –û—á–∏—Å—Ç–∫–∞ storage_costs (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤)
SELECT * FROM public.cleanup_storage_costs();
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
deleted_count | total_time_ms | batches_processed
--------------+---------------+-------------------
     150000   |     12500     |        15
```

---

## üéØ –®–ê–ì 4: VACUUM –î–õ–Ø –û–°–í–û–ë–û–ñ–î–ï–ù–ò–Ø –ú–ï–°–¢–ê

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å VACUUM –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞.

```sql
-- VACUUM –¥–ª—è –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
VACUUM (VERBOSE, ANALYZE) public.audit_log;
VACUUM (VERBOSE, ANALYZE) public.storage_costs;

-- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ (–ë–õ–û–ö–ò–†–£–ï–¢ —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è!):
-- VACUUM FULL public.audit_log;
-- VACUUM FULL public.storage_costs;
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** `VACUUM FULL` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∏ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏!
–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–≥–æ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.

---

## üéØ –®–ê–ì 5: –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

```sql
SELECT
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size,
  pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) AS table_size,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename) - pg_relation_size(schemaname||'.'||tablename)) AS indexes_size
FROM pg_tables
WHERE schemaname = 'public'
  AND tablename IN ('audit_log', 'storage_costs', 'saor_accruals', 'reviews')
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É CRON –∑–∞–¥–∞—á:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ CRON –∑–∞–¥–∞—á–∏ –æ—á–∏—Å—Ç–∫–∏
SELECT
  jobname,
  schedule,
  active,
  CASE schedule
    WHEN '0 3 * * 0' THEN '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 03:00 UTC'
    WHEN '0 2 1 * *' THEN '1-–µ —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞ 02:00 UTC'
    ELSE schedule
  END as schedule_readable
FROM cron.job
WHERE jobname LIKE 'cleanup-%'
ORDER BY jobname;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏
SELECT
  j.jobname,
  d.status,
  d.start_time,
  d.end_time,
  d.return_message
FROM cron.job j
LEFT JOIN LATERAL (
  SELECT *
  FROM cron.job_run_details
  WHERE jobid = j.jobid
  ORDER BY end_time DESC
  LIMIT 1
) d ON true
WHERE j.jobname LIKE 'cleanup-%'
ORDER BY d.end_time DESC;
```

---

## üéØ –®–ê–ì 6: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶–´ SAOR_ACCRUALS (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 70 MB, –Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ.

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (> 90 –¥–Ω–µ–π)

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d+ saor_accruals

-- 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–∞–º
SELECT
  DATE_TRUNC('month', created_at) as month,
  COUNT(*) as records,
  pg_size_pretty(SUM(pg_column_size(saor_accruals.*))) as size
FROM public.saor_accruals
GROUP BY 1
ORDER BY 1 DESC;

-- 3. –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π (–±–∞—Ç—á–∞–º–∏)
DO $$
DECLARE
  v_deleted_count BIGINT := 0;
  v_rows_deleted INT;
  v_cutoff_date TIMESTAMPTZ;
BEGIN
  v_cutoff_date := NOW() - INTERVAL '90 days';

  LOOP
    DELETE FROM public.saor_accruals
    WHERE id IN (
      SELECT id
      FROM public.saor_accruals
      WHERE created_at < v_cutoff_date
      ORDER BY created_at ASC
      LIMIT 10000
    );

    GET DIAGNOSTICS v_rows_deleted = ROW_COUNT;
    EXIT WHEN v_rows_deleted = 0;

    v_deleted_count := v_deleted_count + v_rows_deleted;
    RAISE NOTICE '–£–¥–∞–ª–µ–Ω–æ % –∑–∞–ø–∏—Å–µ–π (–≤—Å–µ–≥–æ: %)', v_rows_deleted, v_deleted_count;

    PERFORM pg_sleep(0.1);
  END LOOP;

  RAISE NOTICE '–û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –≤—Å–µ–≥–æ —É–¥–∞–ª–µ–Ω–æ % –∑–∞–ø–∏—Å–µ–π', v_deleted_count;
END $$;

-- 4. VACUUM –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞
VACUUM (VERBOSE, ANALYZE) public.saor_accruals;
```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

```sql
-- ‚ö†Ô∏è –û–°–¢–û–†–û–ñ–ù–û! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ!

-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ —Ç–∞–±–ª–∏—Ü–∞
SELECT
  schemaname,
  tablename,
  n_tup_ins as inserts,
  n_tup_upd as updates,
  n_tup_del as deletes,
  last_vacuum,
  last_autovacuum
FROM pg_stat_user_tables
WHERE tablename = 'saor_accruals';

-- 2. –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —É–¥–∞–ª–∏—Ç—å
-- DROP TABLE IF EXISTS public.saor_accruals CASCADE;
```

---

## üéØ –®–ê–ì 7: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:

```sql
-- –ù–∞–π—Ç–∏ –∏–Ω–¥–µ–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å
SELECT
  schemaname,
  tablename,
  indexname,
  pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,
  idx_scan as scans
FROM pg_stat_user_indexes
WHERE idx_scan = 0
  AND schemaname = 'public'
  AND indexrelid NOT IN (
    -- –ò—Å–∫–ª—é—á–∞–µ–º –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
    SELECT indexrelid
    FROM pg_index
    WHERE indisprimary OR indisunique
  )
ORDER BY pg_relation_size(indexrelid) DESC;

-- –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã (–û–°–¢–û–†–û–ñ–ù–û!)
-- DROP INDEX IF EXISTS index_name;
```

### –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```sql
-- –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü
CREATE OR REPLACE VIEW public.v_table_sizes AS
SELECT
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size,
  pg_size_pretty(pg_relation_size(schemaname||'.'||tablename)) AS table_size,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename) - pg_relation_size(schemaname||'.'||tablename)) AS indexes_size,
  pg_total_relation_size(schemaname||'.'||tablename) AS bytes
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
SELECT * FROM public.v_table_sizes LIMIT 20;
```

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –†–∞–∑–º–µ—Ä –ë–î: ~600 MB
- replicas: 337 MB
- saor_accruals: 70 MB
- audit_log: 63 MB
- storage_costs: 24 MB

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ 1-2 –Ω–µ–¥–µ–ª–∏):
- –†–∞–∑–º–µ—Ä –ë–î: ~450-500 MB (**-100-150 MB**)
- audit_log: ~10-20 MB (**-40-50 MB**)
- storage_costs: ~12-15 MB (**-10-12 MB**)
- saor_accruals: ~20-30 MB (**-40-50 MB**, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã–≥–æ–¥—ã:
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ backup/restore
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ë–î –≤ –±—É–¥—É—â–µ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

---

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
SELECT
  pg_size_pretty(pg_database_size(current_database())) as database_size;

-- –¢–æ–ø-10 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
SELECT * FROM public.v_table_sizes LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ CRON –∑–∞–¥–∞—á
SELECT
  jobname,
  active,
  (SELECT MAX(end_time) FROM cron.job_run_details WHERE jobid = j.jobid) as last_run
FROM cron.job j
WHERE jobname LIKE 'cleanup-%'
ORDER BY jobname;
```

### –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º—ë—Ä—Ç–≤—ã—Ö —Å—Ç—Ä–æ–∫ (dead tuples)
SELECT
  schemaname,
  tablename,
  n_live_tup as live_tuples,
  n_dead_tup as dead_tuples,
  ROUND(100.0 * n_dead_tup / NULLIF(n_live_tup + n_dead_tup, 0), 2) as dead_ratio
FROM pg_stat_user_tables
WHERE n_dead_tup > 1000
ORDER BY n_dead_tup DESC;

-- –ï—Å–ª–∏ dead_ratio > 20%, –≤—ã–ø–æ–ª–Ω–∏—Ç—å VACUUM
-- VACUUM (VERBOSE, ANALYZE) table_name;
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø

1. **VACUUM FULL –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É** - –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–¥–µ–ª–∞–π—Ç–µ backup –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º VACUUM FULL
3. **–¢–∞–±–ª–∏—Ü–∞ replicas** - –Ω–µ —É–¥–∞–ª—è–π—Ç–µ –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å Supabase support
4. **–ë–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ** - reviews –∏ products –Ω–µ —É–¥–∞–ª—è–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ dev-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
- Supabase Support: https://supabase.com/support
- PostgreSQL Documentation: https://www.postgresql.org/docs/

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø

- [ ] –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ replicas
- [ ] –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏
- [ ] –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–µ–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏
- [ ] –®–∞–≥ 4: –í—ã–ø–æ–ª–Ω–µ–Ω VACUUM –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] –®–∞–≥ 6: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ saor_accruals
- [ ] –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Claude Code
**–î–∞—Ç–∞:** 2026-01-25
