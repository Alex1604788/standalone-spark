# üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase (6GB)

## üéØ –¶–µ–ª—å
–í—ã—è–≤–∏—Ç—å —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 6GB –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: SQL Editor –≤ Supabase (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor:
   ```
   https://supabase.com/dashboard/project/bkmicyguzlwampuindff/sql/new
   ```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `SIMPLE_SIZE_CHECK.sql`
   - –≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç –¢–û–ü 20 —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
   - –£–≤–∏–¥–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –∏–Ω–¥–µ–∫—Å–æ–≤

3. –î–ª—è –ü–û–õ–ù–û–ô –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `DATABASE_SIZE_DIAGNOSTIC.sql`
   - 12 —à–∞–≥–æ–≤ –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ê–Ω–∞–ª–∏–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ê–Ω–∞–ª–∏–∑ TOAST –∏ dead tuples

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ë–î (–ø–æ–ª—É—á–∏—Ç–µ –≤ Project Settings -> Database)
export SUPABASE_DB_PASSWORD="–≤–∞—à-–ø–∞—Ä–æ–ª—å"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç
psql "postgresql://postgres.bkmicyguzlwampuindff@aws-1-eu-west-1.pooler.supabase.com:5432/postgres" -f DATABASE_SIZE_DIAGNOSTIC.sql
```

## üìã –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. **–†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü**
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
- –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤
- –†–∞–∑–º–µ—Ä TOAST –¥–∞–Ω–Ω—ã—Ö

### 2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π**
- –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –í—ã—è–≤–ª–µ–Ω–∏–µ —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

### 3. **–î—É–±–ª–∏–∫–∞—Ç—ã**
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤:
- `reviews` (–æ—Ç–∑—ã–≤—ã)
- `products` (—Ç–æ–≤–∞—Ä—ã)
- `ozon_performance_daily` (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- `replies` (–æ—Ç–≤–µ—Ç—ã)

### 4. **–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ**
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ä—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—Ä–æ–∫–∞:
- `logs_ai` - >90 –¥–Ω–µ–π
- `ai_reply_history` - >90 –¥–Ω–µ–π
- `audit_log` - >180 –¥–Ω–µ–π
- `consent_logs` - >180 –¥–Ω–µ–π
- `fallback_action_logs` - >180 –¥–Ω–µ–π
- `import_logs` - >90 –¥–Ω–µ–π
- `ozon_sync_history` - >90 –¥–Ω–µ–π

### 5. **TOAST –¥–∞–Ω–Ω—ã–µ**
- –ë–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü —Å TOAST —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

### 6. **Dead tuples**
- –ù–µ—É–¥–∞–ª–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–µ–π
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ VACUUM

### 7. **–í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑**
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –º–µ—Å—è—Ü–∞–º
- –î–∏–Ω–∞–º–∏–∫–∞ —Ä–æ—Å—Ç–∞ —Ç–∞–±–ª–∏—Ü

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ 6GB

### –í–µ—Ä–æ—è—Ç–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã:

1. **–¢–∞–±–ª–∏—Ü–∞ `reviews`**
   - –ú–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–æ–≤ —Å –¥–ª–∏–Ω–Ω—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏
   - –í–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
   - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

2. **–¢–∞–±–ª–∏—Ü–∞ `chat_messages`**
   - –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏
   - –î–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –í–ª–æ–∂–µ–Ω–∏—è –≤ –≤–∏–¥–µ JSON

3. **–¢–∞–±–ª–∏—Ü–∞ `ozon_performance_daily`**
   - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
   - –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤
   - –í–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã

4. **–õ–æ–≥–∏**
   - `logs_ai` - –∏—Å—Ç–æ—Ä–∏—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
   - `audit_log` - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - `ozon_sync_history` - –∏—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

5. **–ò–Ω–¥–µ–∫—Å—ã**
   - –ú–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ 50% —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
   - –í–æ–∑–º–æ–∂–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

6. **TOAST –¥–∞–Ω–Ω—ã–µ**
   - –ë–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è —Ö—Ä–∞–Ω—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
   - review_text, reply_text, message –∏ —Ç.–¥.

7. **Dead tuples**
   - –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ UPDATE
   - –¢—Ä–µ–±—É–µ—Ç—Å—è VACUUM

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

#### ‚úÖ –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å:
- –°—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ (>90 –¥–Ω–µ–π)
- –î—É–±–ª–∏–∫–∞—Ç—ã –≤ reviews, products
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ import_logs
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ ozon_sync_history

#### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞:
- –°–∫–æ–ª—å–∫–æ reviews –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å?
- –ù—É–∂–Ω–∞ –ª–∏ –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è chat_messages?
- –ú–æ–∂–Ω–æ –ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ ozon_performance_daily?

#### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
- –ó–∞–ø—É—Å—Ç–∏—Ç—å VACUUM FULL –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è dead tuples
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `DATABASE_SIZE_DIAGNOSTIC.sql` –≤—ã —É–≤–∏–¥–∏—Ç–µ:

1. **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ë–î** - —Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
2. **–¢–û–ü —Ç–∞–±–ª–∏—Ü** - —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ
3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π** - –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
4. **–î—É–±–ª–∏–∫–∞—Ç—ã** - –µ—Å—Ç—å –ª–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ
5. **–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** - —Å–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
6. **TOAST —Ä–∞–∑–º–µ—Ä** - –±–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
7. **Dead tuples** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ VACUUM
8. **–í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑** - –¥–∏–Ω–∞–º–∏–∫–∞ —Ä–æ—Å—Ç–∞

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **SIMPLE_SIZE_CHECK.sql** - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (30 —Å–µ–∫)
2. **DATABASE_SIZE_DIAGNOSTIC.sql** - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (2-3 –º–∏–Ω)
3. **basic-diagnostic.mjs** - Node.js —Å–∫—Ä–∏–ø—Ç (—Ç—Ä–µ–±—É–µ—Ç service role key)
4. **quick-db-diagnostic.mjs** - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Node.js —Å–∫—Ä–∏–ø—Ç
5. **database-diagnostics.mjs** - CLI –≤–µ—Ä—Å–∏—è

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ `SIMPLE_SIZE_CHECK.sql` –≤ SQL Editor
2. üìä –ò–∑—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã - –∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ
3. üîç –ó–∞–ø—É—Å—Ç–∏—Ç–µ `DATABASE_SIZE_DIAGNOSTIC.sql` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
4. üí¨ –û–±—Å—É–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —á—Ç–æ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
5. ‚ö†Ô∏è **–ù–ï –£–î–ê–õ–Ø–ô–¢–ï** –Ω–∏—á–µ–≥–æ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

**–ü–û–ö–ê –ù–ò–ß–ï–ì–û –ù–ï –£–î–ê–õ–Ø–ï–ú!**
–≠—Ç–æ —Ç–æ–ª—å–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Å—É–¥–∏–º —á—Ç–æ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å.
