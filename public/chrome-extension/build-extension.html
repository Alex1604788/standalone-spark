<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–±–æ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 0;
    }
    button:hover {
      background: #5568d3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      background: #f3f4f6;
    }
    .success {
      background: #d1fae5 !important;
      color: #065f46;
    }
    .error {
      background: #fee2e2 !important;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <h1>üöÄ –°–±–æ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç</h1>
  <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å ZIP-–∞—Ä—Ö–∏–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è Chrome.</p>
  
  <button id="buildBtn" onclick="buildExtension()">–°–æ–±—Ä–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (ZIP)</button>
  
  <div id="status"></div>

  <script>
    async function buildExtension() {
      const btn = document.getElementById('buildBtn');
      const status = document.getElementById('status');
      
      btn.disabled = true;
      status.textContent = '–°–±–æ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è...';
      status.className = '';
      
      try {
        const zip = new JSZip();
        
        // –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –∞—Ä—Ö–∏–≤
        const files = [
          'manifest.json',
          'popup.html',
          'popup.js',
          'background.js',
          'content.js',
          'content_publish.js',
          'README.md'
        ];
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
        for (const file of files) {
          try {
            const response = await fetch(file);
            if (!response.ok) throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${file}`);
            const content = await response.text();
            zip.file(file, content);
            console.log(`‚úì –î–æ–±–∞–≤–ª–µ–Ω: ${file}`);
          } catch (err) {
            console.warn(`‚ö† –ü—Ä–æ–ø—É—â–µ–Ω: ${file}`, err.message);
          }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        const icons = ['icon16.png', 'icon48.png', 'icon128.png', 'icon512.png'];
        for (const icon of icons) {
          try {
            const response = await fetch(icon);
            if (response.ok) {
              const blob = await response.blob();
              zip.file(icon, blob);
              console.log(`‚úì –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–∫–æ–Ω–∫–∞: ${icon}`);
            }
          } catch (err) {
            console.warn(`‚ö† –ò–∫–æ–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${icon}`);
          }
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ZIP
        const blob = await zip.generateAsync({ type: 'blob' });
        
        // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'avtoOtvet-extension-v2.0.3.zip';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        status.textContent = '‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω–æ –∏ —Å–∫–∞—á–∞–Ω–æ!';
        status.className = 'success';
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏:', error);
        status.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏: ' + error.message;
        status.className = 'error';
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
