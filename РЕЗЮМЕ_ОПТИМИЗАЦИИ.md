# üéØ –†–ï–ó–Æ–ú–ï: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–•

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-01-25

---

## üìä –¢–ï–ö–£–©–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø

### –°–∞–º—ã–µ –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã:

| –¢–∞–±–ª–∏—Ü–∞ | –†–∞–∑–º–µ—Ä | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|--------|----------|---------|
| **replicas** | 337 MB | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ | üîç –¢—Ä–µ–±—É–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ |
| **saor_accruals** | 70 MB | –ù–µ—Ç –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ | ‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **audit_log** | 63 MB | –ù–µ—Ç –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ | ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è (90 –¥–Ω–µ–π) |
| **job_run_details** | 54 MB | - | ‚úÖ –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ |
| **reviews** | 32 MB | –ë–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ | ‚ÑπÔ∏è –ù–µ —Ç—Ä–æ–≥–∞—Ç—å |
| **storage_costs** | 24 MB | –ù–µ—Ç –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ | ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è (6 –º–µ—Å—è—Ü–µ–≤) |

**–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ë–î:** ~600 MB
**–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** 100-150 MB (20-25%)

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. –°–æ–∑–¥–∞–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- ‚úÖ `–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md` - –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- ‚úÖ `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_REPLICAS.sql` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∞–º–æ–π –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ `–†–ï–ó–Æ–ú–ï_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò.md` - —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

### 2. –°–æ–∑–¥–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ `20260125120700_cleanup_audit_log.sql` - –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ audit_log (90 –¥–Ω–µ–π)
- ‚úÖ `20260125120800_cleanup_storage_costs.sql` - –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ storage_costs (6 –º–µ—Å—è—Ü–µ–≤)

### 3. –£–∂–µ –±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (—Ä–∞–Ω–µ–µ):
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `ai_reply_history` (30 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `logs_ai` (7 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `import_logs` (7 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `ozon_sync_history` (30 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `job_run_details` (7 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `fallback_action_logs` (7 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ `consent_logs` (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å)

---

## üéØ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ replicas (5 –º–∏–Ω—É—Ç)
```bash
# –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_REPLICAS.sql –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (2 –º–∏–Ω—É—Ç—ã)
```bash
# –°–ø–æ—Å–æ–± 1: CLI
supabase db push

# –°–ø–æ—Å–æ–± 2: Dashboard
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ SQL Editor:
# - supabase/migrations/20260125120700_cleanup_audit_log.sql
# - supabase/migrations/20260125120800_cleanup_storage_costs.sql
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –≤—Ä—É—á–Ω—É—é (–ø–µ—Ä–≤—ã–π —Ä–∞–∑) (5-10 –º–∏–Ω—É—Ç)
```sql
-- –û—á–∏—Å—Ç–∫–∞ audit_log (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ > 90 –¥–Ω–µ–π)
SELECT * FROM public.cleanup_audit_log();

-- –û—á–∏—Å—Ç–∫–∞ storage_costs (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ > 6 –º–µ—Å—è—Ü–µ–≤)
SELECT * FROM public.cleanup_storage_costs();
```

### –®–∞–≥ 4: VACUUM –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞ (5-10 –º–∏–Ω—É—Ç)
```sql
VACUUM (VERBOSE, ANALYZE) public.audit_log;
VACUUM (VERBOSE, ANALYZE) public.storage_costs;
```

**–ò—Ç–æ–≥–æ:** ~15-30 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- –û—á–∏—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ –≤ `audit_log` ‚Üí **-40-50 MB**
- –û—á–∏—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `storage_costs` ‚Üí **-10-12 MB**

### –ß–µ—Ä–µ–∑ 1-2 –Ω–µ–¥–µ–ª–∏:
- –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü —Å –ª–æ–≥–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤

### –ß–µ—Ä–µ–∑ 1 –º–µ—Å—è—Ü:
- –†–∞–∑–º–µ—Ä –ë–î —É–º–µ–Ω—å—à–∏—Ç—Å—è –Ω–∞ **100-150 MB (20-25%)**
- –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ backup/restore
- –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

---

## üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞:

#### 1. –û—á–∏—Å—Ç–∏—Ç—å saor_accruals (~40-50 MB)
```sql
-- –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
-- –°–º. –ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md, –®–∞–≥ 6
```

#### 2. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ reviews (~10-15 MB)
```sql
-- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ—Ç–∑—ã–≤—ã —Å—Ç–∞—Ä—à–µ 2 –ª–µ—Ç –≤ –∞—Ä—Ö–∏–≤
-- –°–º. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md, —Ä–∞–∑–¥–µ–ª 5
```

#### 3. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
```sql
-- –ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Å idx_scan = 0
-- –°–º. –ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md, –®–∞–≥ 7
```

---

## üìã –ù–û–í–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï CRON –ó–ê–î–ê–ß

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:

| –ó–∞–¥–∞—á–∞ | –¢–∞–±–ª–∏—Ü–∞ | –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|-----------------|------------|
| cleanup-ai-reply-history-weekly | ai_reply_history | 30 –¥–Ω–µ–π | –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 04:00 UTC |
| cleanup-logs-ai-daily | logs_ai | 7 –¥–Ω–µ–π | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 05:00 UTC |
| cleanup-import-logs-daily | import_logs | 7 –¥–Ω–µ–π | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 05:30 UTC |
| cleanup-ozon-sync-history-weekly | ozon_sync_history | 30 –¥–Ω–µ–π | –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 06:00 UTC |
| cleanup-cron-job-run-details-daily | job_run_details | 7 –¥–Ω–µ–π | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 06:00 UTC |
| cleanup-fallback-action-logs-daily | fallback_action_logs | 7 –¥–Ω–µ–π | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 06:30 UTC |
| cleanup-consent-logs-daily | consent_logs | –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 07:00 UTC |
| **cleanup-audit-log-weekly** ‚≠ê | **audit_log** | **90 –¥–Ω–µ–π** | **–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 03:00 UTC** |
| **cleanup-storage-costs-monthly** ‚≠ê | **storage_costs** | **6 –º–µ—Å—è—Ü–µ–≤** | **1-–µ —á–∏—Å–ª–æ 02:00 UTC** |

‚≠ê = –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

---

## üìû –ù–£–ñ–ù–ê –ü–û–ú–û–©–¨?

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- üìñ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ ‚Üí `–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md`
- üìò –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ‚Üí `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md`
- üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ replicas ‚Üí `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_REPLICAS.sql`
- üìã –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ ‚Üí `–ü–†–ê–í–ò–õ–ê_–û–ß–ò–°–¢–ö–ò_–õ–û–ì–û–í_–£–¢–í–ï–†–ñ–î–ï–ù–û.md`

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞:
- Supabase Support: https://supabase.com/support
- PostgreSQL Docs: https://www.postgresql.org/docs/

---

## ‚úÖ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É replicas ‚Üí `–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê_REPLICAS.sql`
2. [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Üí `supabase db push`
3. [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –≤—Ä—É—á–Ω—É—é ‚Üí —Å–º. –®–∞–≥ 3 –≤—ã—à–µ
4. [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å VACUUM ‚Üí —Å–º. –®–∞–≥ 4 –≤—ã—à–µ
5. [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí `SELECT * FROM public.v_table_sizes;`
6. [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Üí —Å–º. `–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø_–ë–î.md`

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Claude Code
**–î–∞—Ç–∞:** 2026-01-25
**–í–µ—Ä—Å–∏—è:** 1.0
